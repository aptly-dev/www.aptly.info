<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>aptly - Publishing to S3</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=/favicon.ico><link type=text/css rel=stylesheet href=/css/styles.css><link type=text/css rel=stylesheet href=/swagger-ui/swagger-ui.css><link type=text/css rel=stylesheet href=/css/api.css><link rel=canonical href=https://www.aptly.info/doc/feature/s3/><link href=/post/index.xml rel=alternate type=application/rss+xml title="Debian repository management tool"></head><body><header id=page-header><div class=container><div style=display:flex;align-items:end><div class=text-center style=font-size:9px><a class=brand href=/><i class=brand-logo></i>
<span class=brand-name>aptly</span></a></div><div style=flex-grow:1><nav class="navbar navbar-default navbar-static-top" role=navigation><ul class="nav navbar-nav nav-justified"><li><a href=/tutorial/>tutorials</a></li><li><a href=/download/>download</a></li><li><a href=/support/>support</a></li><li class=active><a href=/doc/overview/>documentation</a></li><li><a href=/about/>about</a></li><li><a href=/post/>blog</a></li></ul></nav></div></div></div><div class=container></div></header><script src=/swagger-ui/swagger-ui-bundle.js></script><script src=/swagger-ui/swagger-ui-standalone-preset.js></script><section class=documentation><div class=container><div class=sidebar-overlay></div><div class=row><div class="col-md-3 col-sm-3 col-xs-3"><div class=sidebar><ul class="nav nav-sidebar"><li><a href=/doc/overview/>Overview</a></li><li><a href=/doc/why/>Why aptly?</a></li><li><a href=/doc/faq/>FAQ</a></li><li class=active><a href=/doc/features/>Features</a><ul class=nav><li><a href=/doc/feature/query/>Package Queries</a></li><li><a href=/doc/feature/duplicate/>Duplicate Packages</a></li><li class=active><a href=/doc/feature/s3/>Publishing to S3</a></li><li><a href=/doc/feature/swift/>Publishing to Swift</a></li><li><a href=/doc/feature/filesystem/>Filesystem Publishing</a></li><li><a href=/doc/feature/multi-component/>Multi-Component Publishing</a></li><li><a href=/doc/feature/pgp-providers/>PGP Providers</a></li><li><a href=/doc/feature/package-display/>Package Display Format</a></li><li><a href=/doc/feature/dependencies/>Dependency Resolving</a></li></ul></li><li><a href=/doc/configuration/>Configuration</a></li><li><a href=/doc/commands/>Commands</a><ul class=nav><li><a href=/doc/aptly/flags/>Global Flags</a></li><li><a href=/doc/aptly/mirror/>aptly mirror</a><ul class=nav><li><a href=/doc/aptly/mirror/create/>aptly mirror create</a></li><li><a href=/doc/aptly/mirror/update/>aptly mirror update</a></li><li><a href=/doc/aptly/mirror/list/>aptly mirror list</a></li><li><a href=/doc/aptly/mirror/show/>aptly mirror show</a></li><li><a href=/doc/aptly/mirror/edit/>aptly mirror edit</a></li><li><a href=/doc/aptly/mirror/search/>aptly mirror search</a></li><li><a href=/doc/aptly/mirror/rename/>aptly mirror rename</a></li><li><a href=/doc/aptly/mirror/drop/>aptly mirror drop</a></li></ul></li><li><a href=/doc/aptly/repo/>aptly repo</a><ul class=nav><li><a href=/doc/aptly/repo/create/>aptly repo create</a></li><li><a href=/doc/aptly/repo/add/>aptly repo add</a></li><li><a href=/doc/aptly/repo/include/>aptly repo include</a></li><li><a href=/doc/aptly/repo/import/>aptly repo import</a></li><li><a href=/doc/aptly/repo/show/>aptly repo show</a></li><li><a href=/doc/aptly/repo/list/>aptly repo list</a></li><li><a href=/doc/aptly/repo/copy/>aptly repo copy</a></li><li><a href=/doc/aptly/repo/move/>aptly repo move</a></li><li><a href=/doc/aptly/repo/remove/>aptly repo remove</a></li><li><a href=/doc/aptly/repo/search/>aptly repo search</a></li><li><a href=/doc/aptly/repo/edit/>aptly repo edit</a></li><li><a href=/doc/aptly/repo/rename/>aptly repo rename</a></li><li><a href=/doc/aptly/repo/drop/>aptly repo drop</a></li></ul></li><li><a href=/doc/aptly/snapshot/>aptly snapshot</a><ul class=nav><li><a href=/doc/aptly/snapshot/create/>aptly snapshot create</a></li><li><a href=/doc/aptly/snapshot/list/>aptly snapshot list</a></li><li><a href=/doc/aptly/snapshot/show/>aptly snapshot show</a></li><li><a href=/doc/aptly/snapshot/verify/>aptly snapshot verify</a></li><li><a href=/doc/aptly/snapshot/pull/>aptly snapshot pull</a></li><li><a href=/doc/aptly/snapshot/filter/>aptly snapshot filter</a></li><li><a href=/doc/aptly/snapshot/diff/>aptly snapshot diff</a></li><li><a href=/doc/aptly/snapshot/merge/>aptly snapshot merge</a></li><li><a href=/doc/aptly/snapshot/search/>aptly snapshot search</a></li><li><a href=/doc/aptly/snapshot/rename/>aptly snapshot rename</a></li><li><a href=/doc/aptly/snapshot/drop/>aptly snapshot drop</a></li></ul></li><li><a href=/doc/aptly/package/>aptly package</a><ul class=nav><li><a href=/doc/aptly/package/search/>aptly package search</a></li><li><a href=/doc/aptly/package/show/>aptly package show</a></li></ul></li><li><a href=/doc/aptly/publish/>aptly publish</a><ul class=nav><li><a href=/doc/aptly/publish/snapshot/>aptly publish snapshot</a></li><li><a href=/doc/aptly/publish/repo/>aptly publish repo</a></li><li><a href=/doc/aptly/publish/update/>aptly publish update</a></li><li><a href=/doc/aptly/publish/switch/>aptly publish switch</a></li><li><a href=/doc/aptly/publish/list/>aptly publish list</a></li><li><a href=/doc/aptly/publish/show/>aptly publish show</a></li><li><a href=/doc/aptly/publish/drop/>aptly publish drop</a></li></ul></li><li><a href=/doc/aptly/db/>aptly db</a><ul class=nav><li><a href=/doc/aptly/db/cleanup/>aptly db cleanup</a></li><li><a href=/doc/aptly/db/recover/>aptly db recover</a></li></ul></li><li><a href=/doc/aptly/task/>aptly task</a><ul class=nav><li><a href=/doc/aptly/task/run/>aptly task run</a></li></ul></li><li><a href=/doc/aptly/serve/>aptly serve</a></li><li><a href=/doc/aptly/config/>aptly config</a><ul class=nav><li><a href=/doc/aptly/config/show/>aptly config show</a></li></ul></li><li><a href=/doc/aptly/graph/>aptly graph</a></li></ul></li><li><a href=/doc/api/swagger/>REST API Documentation</a></li><li><a href=/doc/api/>Legacy API</a><ul class=nav><li><a href=/doc/api/repos/>Local Repos API</a></li><li><a href=/doc/api/mirror/>Mirrors API</a></li><li><a href=/doc/api/files/>File Upload API</a></li><li><a href=/doc/api/snapshots/>Snapshot API</a></li><li><a href=/doc/api/publish/>Publish API</a></li><li><a href=/doc/api/packages/>Package API</a></li><li><a href=/doc/api/misc/>Misc API</a></li></ul></li><li><a href=/doc/integrations/>Integrations</a></li></ul><div class=source-buttons><a href=/download/ class="btn btn-danger">Download</a>
<a href=https://github.com/aptly-dev/aptly class="btn btn-default">Github</a></div></div></div><div class="col-md-9 col-sm-9 col-xs-9"><h2 id=publishing-to-amazon-s3>Publishing to Amazon S3</h2><p>aptly could be configured to publish repository directly to Amazon S3 (or S3-compatible
cloud storage).
First, publishing endpoints should be described in aptly
<a href=/doc/configuration/>configuration</a> file. Each endpoint has name and
associated settings:</p><ul><li><code>region</code>: Amazon region for S3 bucket (e.g. <code>us-east-1</code>)</li><li><code>bucket</code>: bucket name</li><li><code>endpoint</code>: (optional) when using S3-compatible cloud storage, specify hostname of service endpoint here,
region is ignored if endpoint is set (set <code>region</code> to some human-readable name)
(should be left blank for real Amazon S3)</li><li><code>prefix</code>: (optional) do publishing under specified prefix in the
bucket, defaults to no prefix (bucket root)</li><li><code>acl</code>: (optional) assign ACL to published files (one of the canned
ACLs in Amazon terminology). Useful values: <code>private</code> (default),
<code>public-read</code> (public repository) or <code>none</code> (don&rsquo;t set ACL). Public repositories could be
consumed by <code>apt</code> using HTTP endpoint (Amazon bucket should be
configured for &ldquo;website hosting&rdquo;), for private repositories special
apt S3 transport is required.</li><li><code>awsAccessKeyID</code>, <code>awsSecretAccessKey</code>: (optional) Amazon
credentials to access S3 bucket. If not supplied, environment
variables <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code> are used.</li><li><code>storageClass</code>: (optional) Amazon S3 storage class, defaults to <code>STANDARD</code>. Other values
available: <code>REDUCED_REDUNDANCY</code> (lower price, lower redundancy)</li><li><code>encryptionMethod</code>: (optional) server-side encryption method, defaults to none. Currently
the only available encryption method is <code>AES256</code></li><li><code>plusWorkaround</code>: (optional) workaround misbehavior in apt and Amazon S3
(see <a href=https://bugs.launchpad.net/ubuntu/+source/apt/+bug/1003633>bug</a>) by
creating two copies of package files with <code>+</code> in filename: one original
and another one with spaces instead of plus signs<div class="alert alert-warning alert-note"><strong>Warning:</strong>
With <strong>plusWorkaround</strong> enabled, package files with plus sign
would be stored twice. aptly might not cleanup files with spaces when published
repository is dropped or updated (switched) to new version of repository (snapshot).</div></li><li><code>disableMultiDel</code>: (optional) for S3-compatible cloud storages which do not support <code>MultiDel</code> S3 API,
enable this setting (file deletion would be slower with this setting enabled)</li><li><code>forceSigV2</code>: (optional) disable Signature V4 support, useful with non-AWS S3-compatible object stores
which do not support SigV4, shouldn&rsquo;t be enabled for AWS</li><li><code>debug</code>: (optional) enables detailed request/response dump for each S3 operation</li></ul><p>S3 bucket used for publishing should be empty initially and should not
be used to store other data, as aptly might remove objects while doing
cleanup operation. If <code>prefix</code> is configured, bucket should be empty
under the prefix (aptly won&rsquo;t touch any objects outside prefix).</p><p>In order to publish to S3, specify endpoint as <code>s3:endpoint-name:</code>
before publishing prefix on the command line, e.g.:</p><pre><code>$ aptly publish snapshot wheezy-main s3:test:
</code></pre><p>Or, with prefix:</p><pre><code>$ aptly publish snapshot wheezy-main s3:test:debian/
</code></pre><p>If you would like to publish public repository to Amazon S3, create
bucket, enable website hosting option at Amazon console. Specify bucket
name, region and access keys in aptly configuration under
<code>S3PublishEndpoints</code>. Use <code>public-read</code> as value for <code>acl</code> parameter.
Published repository could be added to <code>/etc/apt/sources.list</code> by using
public HTTP URL, like any other HTTP repository.</p><p>For accessing S3 based private repositories
<a href=https://tracker.debian.org/pkg/apt-transport-s3>apt-transport-s3</a> should be used.
Package providing this functionality is available in Ubuntu 15.04 and Debian
Strech (currently Jessie+1). For information how to use it read docs on project
<a href=https://github.com/BashtonLtd/apt-transport-s3>website</a> or read the man page
(apt-transport-s3(8)).</p><p>Other options like <a href=https://github.com/brianm/apt-s3/>apt-s3</a> are also
available to use. Please don&rsquo;t enable website hosting option and use
<code>private</code> as value for <code>acl</code> parameter.</p><p>Install <a href=https://tracker.debian.org/pkg/apt-transport-s3>apt-transport-s3</a>,
<a href=https://github.com/brianm/apt-s3/>apt-s3</a> or any other similar tool to
enable <code>s3://</code> transport in <code>apt</code>.</p><p>It is recommended to setup separate user in Amazon IAM for publishing to
S3. This user would have access only to one bucket for publishing and
limited operations. Sample policy (change <code>bucket</code> to match you bucket
name):</p><pre><code>{
  &quot;Version&quot;: &quot;2012-10-17&quot;,
  &quot;Statement&quot;: [
    {
      &quot;Sid&quot;: &quot;Stmt1405592139000&quot;,
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Action&quot;: [
        &quot;s3:DeleteObject&quot;,
        &quot;s3:GetObject&quot;,
        &quot;s3:ListBucket&quot;,
        &quot;s3:PutObject&quot;,
        &quot;s3:PutObjectAcl&quot;
      ],
      &quot;Resource&quot;: [
        &quot;arn:aws:s3:::bucket/*&quot;, &quot;arn:aws:s3:::bucket&quot;
      ]
    }
  ]
}
</code></pre><p> </p></div></div></div></section><footer id=page-footer><div class=container></div></footer></body></html>