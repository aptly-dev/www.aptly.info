<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>aptly - aptly repo include</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=/favicon.ico><link type=text/css rel=stylesheet href=/css/styles.css><link rel=canonical href=https://www.aptly.info/doc/aptly/repo/include/><link href=/post/index.xml rel=alternate type=application/rss+xml title="Debian repository management tool"></head><body><header id=page-header><div class=container><nav class="navbar navbar-default navbar-static-top" role=navigation><ul class="nav navbar-nav nav-justified"><li><a href=/tutorial/>tutorials</a></li><li><a href=/download/>download</a></li><li><a href=/support/>support</a></li><li class=active><a href=/doc/overview/>documentation</a></li><li><a href=/about/>about</a></li><li><a href=/post/>blog</a></li></ul></nav><div class=row><div class="col-md-6 col-md-offset-3 text-center"><a class=brand href=/><i class=brand-logo></i>
<span class=brand-name>aptly</span></a></div></div></div></header><section class=documentation><div class=container><div class=sidebar-overlay></div><div class=row><div class="col-md-3 col-sm-3 col-xs-3"><div class=sidebar><ul class="nav nav-sidebar"><li><a href=/doc/overview/>Overview</a></li><li><a href=/doc/why/>Why aptly?</a></li><li><a href=/doc/faq/>FAQ</a></li><li><a href=/doc/features/>Features</a><ul class=nav><li><a href=/doc/feature/query/>Package Queries</a></li><li><a href=/doc/feature/duplicate/>Duplicate Packages</a></li><li><a href=/doc/feature/s3/>Publishing to S3</a></li><li><a href=/doc/feature/swift/>Publishing to Swift</a></li><li><a href=/doc/feature/filesystem/>Filesystem Publishing</a></li><li><a href=/doc/feature/multi-component/>Multi-Component Publishing</a></li><li><a href=/doc/feature/pgp-providers/>PGP Providers</a></li><li><a href=/doc/feature/package-display/>Package Display Format</a></li><li><a href=/doc/feature/dependencies/>Dependency Resolving</a></li></ul></li><li><a href=/doc/configuration/>Configuration</a></li><li class=active><a href=/doc/commands/>Commands</a><ul class=nav><li><a href=/doc/aptly/flags/>Global Flags</a></li><li><a href=/doc/aptly/mirror/>aptly mirror</a><ul class=nav><li><a href=/doc/aptly/mirror/create/>aptly mirror create</a></li><li><a href=/doc/aptly/mirror/update/>aptly mirror update</a></li><li><a href=/doc/aptly/mirror/list/>aptly mirror list</a></li><li><a href=/doc/aptly/mirror/show/>aptly mirror show</a></li><li><a href=/doc/aptly/mirror/edit/>aptly mirror edit</a></li><li><a href=/doc/aptly/mirror/search/>aptly mirror search</a></li><li><a href=/doc/aptly/mirror/rename/>aptly mirror rename</a></li><li><a href=/doc/aptly/mirror/drop/>aptly mirror drop</a></li></ul></li><li class=active><a href=/doc/aptly/repo/>aptly repo</a><ul class=nav><li><a href=/doc/aptly/repo/create/>aptly repo create</a></li><li><a href=/doc/aptly/repo/add/>aptly repo add</a></li><li class=active><a href=/doc/aptly/repo/include/>aptly repo include</a></li><li><a href=/doc/aptly/repo/import/>aptly repo import</a></li><li><a href=/doc/aptly/repo/show/>aptly repo show</a></li><li><a href=/doc/aptly/repo/list/>aptly repo list</a></li><li><a href=/doc/aptly/repo/copy/>aptly repo copy</a></li><li><a href=/doc/aptly/repo/move/>aptly repo move</a></li><li><a href=/doc/aptly/repo/remove/>aptly repo remove</a></li><li><a href=/doc/aptly/repo/search/>aptly repo search</a></li><li><a href=/doc/aptly/repo/edit/>aptly repo edit</a></li><li><a href=/doc/aptly/repo/rename/>aptly repo rename</a></li><li><a href=/doc/aptly/repo/drop/>aptly repo drop</a></li></ul></li><li><a href=/doc/aptly/snapshot/>aptly snapshot</a><ul class=nav><li><a href=/doc/aptly/snapshot/create/>aptly snapshot create</a></li><li><a href=/doc/aptly/snapshot/list/>aptly snapshot list</a></li><li><a href=/doc/aptly/snapshot/show/>aptly snapshot show</a></li><li><a href=/doc/aptly/snapshot/verify/>aptly snapshot verify</a></li><li><a href=/doc/aptly/snapshot/pull/>aptly snapshot pull</a></li><li><a href=/doc/aptly/snapshot/filter/>aptly snapshot filter</a></li><li><a href=/doc/aptly/snapshot/diff/>aptly snapshot diff</a></li><li><a href=/doc/aptly/snapshot/merge/>aptly snapshot merge</a></li><li><a href=/doc/aptly/snapshot/search/>aptly snapshot search</a></li><li><a href=/doc/aptly/snapshot/rename/>aptly snapshot rename</a></li><li><a href=/doc/aptly/snapshot/drop/>aptly snapshot drop</a></li></ul></li><li><a href=/doc/aptly/package/>aptly package</a><ul class=nav><li><a href=/doc/aptly/package/search/>aptly package search</a></li><li><a href=/doc/aptly/package/show/>aptly package show</a></li></ul></li><li><a href=/doc/aptly/publish/>aptly publish</a><ul class=nav><li><a href=/doc/aptly/publish/snapshot/>aptly publish snapshot</a></li><li><a href=/doc/aptly/publish/repo/>aptly publish repo</a></li><li><a href=/doc/aptly/publish/update/>aptly publish update</a></li><li><a href=/doc/aptly/publish/switch/>aptly publish switch</a></li><li><a href=/doc/aptly/publish/list/>aptly publish list</a></li><li><a href=/doc/aptly/publish/show/>aptly publish show</a></li><li><a href=/doc/aptly/publish/drop/>aptly publish drop</a></li></ul></li><li><a href=/doc/aptly/db/>aptly db</a><ul class=nav><li><a href=/doc/aptly/db/cleanup/>aptly db cleanup</a></li><li><a href=/doc/aptly/db/recover/>aptly db recover</a></li></ul></li><li><a href=/doc/aptly/task/>aptly task</a><ul class=nav><li><a href=/doc/aptly/task/run/>aptly task run</a></li></ul></li><li><a href=/doc/aptly/serve/>aptly serve</a></li><li><a href=/doc/aptly/config/>aptly config</a><ul class=nav><li><a href=/doc/aptly/config/show/>aptly config show</a></li></ul></li><li><a href=/doc/aptly/graph/>aptly graph</a></li></ul></li><li><a href=/doc/api/>API</a><ul class=nav><li><a href=/doc/api/repos/>Local Repos API</a></li><li><a href=/doc/api/mirror/>Mirrors API</a></li><li><a href=/doc/api/files/>File Upload API</a></li><li><a href=/doc/api/snapshots/>Snapshot API</a></li><li><a href=/doc/api/publish/>Publish API</a></li><li><a href=/doc/api/packages/>Package API</a></li><li><a href=/doc/api/misc/>Misc API</a></li></ul></li><li><a href=/doc/integrations/>Integrations</a></li></ul><div class=source-buttons><a href=/download/ class="btn btn-danger">Download</a>
<a href=https://github.com/aptly-dev/aptly class="btn btn-default">Github</a></div></div></div><div class="col-md-9 col-sm-9 col-xs-9"><h2 id=aptly-repo-include>aptly repo include</h2><p>Command allows automatic processing of <code>.changes</code> file controlling
package upload to local repositories.</p><p>Usage:</p><pre><code>$  aptly repo include &lt;file.changes&gt;|&lt;directory&gt; ...
</code></pre><p>Flags:</p><ul><li><code>-accept-unsigned</code>: accept unsigned .changes files</li><li><code>-force-replace</code>: when adding package that conflicts with existing package,
remove existing package</li><li><code>-ignore-signatures</code>: disable verification of .changes file signature</li><li><code>-keyring=</code>: gpg keyring to use when verifying .changes file (could be specified multiple times)</li><li><code>-no-remove-files</code>: don&rsquo;t remove files that have been imported successfully into repository</li><li><code>-repo="{{.Distribution}}"</code>: which repo should files go to, defaults to Distribution field of .changes file</li><li><code>-uploaders-file=""</code>: path to uploaders.json file</li></ul><p>This command allows to implement package upload workflow using Debian tools:
<code>dpkg-genchanges</code>, <code>dput</code>, etc. Set of Debian package files is uploaded together
with <code>.changes</code> file signed by developer and describing changeset.
aptly would verify signature, package integrity and using optional
rules supplied would add package to local repositories.</p><p>List of steps:</p><ol><li>aptly does recursive search for <code>.changes</code> files in paths given as program
arguments</li><li>for every <code>.changes</code> file discovered:</li><li><code>.changes</code> file is copied to temporary directory</li><li>signature presence is checked, if signature is missing <code>.changes</code> file is
rejected (unless <code>-accept-unsigned</code> flag is used)</li><li>signature is verified, GPG key IDs used to sign file are remembered, if
file fails signature verification step, it is rejected (unless
<code>-ignore-signatures</code> flag is given)</li><li>package files referenced in <code>.changes</code> file are copied to temporary directory
and checksums are verified, if checksums don&rsquo;t match <code>.changes</code> file is rejected</li><li>aptly figures out local repository name based on <code>-repo</code> flag and <code>.changes</code> file
fields (see below for details)</li><li>every package file is checked so that it matches fields <code>Architecture</code>, <code>Source</code>
and <code>Binary</code></li><li>if local repository has <code>-uploaders-file</code> attached, it would be used, otherwise
value of <code>-uploaders-file</code> flag would be used; if no <code>-uploaders-file</code> has been given,
it is assumed that anyone can upload any package</li><li><code>.changes</code> file fields and GPG key IDs are matched agains rules in <code>-uploaders-file</code></li><li>package files are added to local repository</li><li>continue to next <code>.changes</code> file</li></ol><p>aptly won&rsquo;t complain if package is added to the repo which is complete
duplicate. However it is forbidden to have two packages in one repo with identical
triples (architecture, name, version) that have different metadata or
files (see <a href=/doc/feature/duplicate>Duplicate packages</a> for details).
If you need to replace package that conflicts with existing, use flag
<code>-force-replace</code>.
All files added to package pool would be deduplicated, as it
happens with files coming from mirrors, so exactly one copy of each file
would be stored in aptly pool.</p><p>Flag <code>-no-remove-files</code> reverts default behaviour to remove all package files sucessfully
imported.</p><p>Example:</p><pre><code>$ aptly repo include incoming/
gpgv: Signature made Sun Mar 15 20:36:44 2015 MSK using DSA key ID 16DB3E6D
gpgv: Good signature from &quot;Aptly Tester (don't use it) &lt;test@aptly.info&gt;&quot;
Loading repository unstable for changes file hardlink_0.2.1_amd64.changes...
[+] hardlink_0.2.1_source added
[+] hardlink_0.2.1_amd64 added
</code></pre><h3 id=repo-name>Repo name</h3><p>For each <code>.changes</code> file local repository name is calculated based on value of <code>-repo</code> flag
and <code>.changes</code> file fields. aptly is using <a href=http://godoc.org/text/template>Go template syntax</a>
for value of <code>-repo</code> flag.</p><p>By default <code>-repo</code> flag has value <code>{{.Distribution}}</code> which means that packages would be
uploaded to local repository matching value of <code>Distribution</code> field in <code>.changes</code> file.
If raw value (e.g. <code>-repo=mysoft</code>) is given, it would be used for any <code>.changes</code> file.</p><p>Values of all <code>.changes</code> file fields are exposed to the template as <code>{{.Field}}</code> replacements.
Templates are powerful, e.g. <code>local-{{.Distribution}}</code> would be expanded to <code>local-</code> concatenated
with <code>Distribution:</code> field value. <code>{{if eq .Source foo}}mysoftware{{else}}foreignsoftware{{end}}</code>
would choose repo name based on test <code>Source: == "foo"</code>.</p><h3 id=uploadersjson>Uploaders.json</h3><p>Uploaders configuration allows to restrict who can upload packages (based on GPG key IDs). Uploaders
file is JSON-based (it allows inline comments and relaxed comma placement):</p><pre><code>{
    &quot;groups&quot;: {
        &quot;admins&quot;: [&quot;1B2AFA1C&quot;],
        // admins can do whatever developers can do
        &quot;developers&quot;: [&quot;21DBB89C16DB3E6D&quot;, &quot;37E1C17570096AD1&quot;, &quot;admins&quot;]
    },
    &quot;rules&quot;: [
        // don't let anyone upload these packages
        { &quot;condition&quot;: &quot;Source (dangerous) | Source (kernel)&quot;,
          &quot;deny&quot;: [&quot;*&quot;]
        },
        // admins and our CTO can upload to stable
        { &quot;condition&quot;: &quot;Distribution (stable)&quot;,
          &quot;allow&quot;: [&quot;admins&quot;, &quot;CEA4B22E&quot;]
        },
        // everybody else is denied upload
        { &quot;condition&quot;: &quot;Distribution (stable)&quot;,
          &quot;deny&quot;: [&quot;*&quot;]
        },
        // hardlink is our favourite package!
        { &quot;condition&quot;: &quot;Source (hardlink)&quot;,
          &quot;allow&quot;: [&quot;developers&quot;, &quot;admins&quot;]
        },
        // arm64 is open to anyone
        {
          &quot;condition&quot;: &quot;Architecture (% *arm64*)&quot;,
          &quot;allow&quot;: [&quot;*&quot;]
        }
    ]
}
</code></pre><p>Uploaders file consists of two parts: groups definition and rules. Groups are optional, but they could
be used to place list of GPG key IDs to be used in rules. Groups may reference other groups, group name
would be expanded to list of GPG key IDs when found in rules.</p><p>GPG keys could be given in short or long format. GPG signature verification produces always long key IDs,
but short keys would match against them. It is recommended long key IDs due to risk of collisions.
Special value <code>*</code> matches against any key.</p><p>Rules are evaluated like firewall from first item to last. If no rules match <code>.changes</code> file, upload
is denied. Each rule consists of three parts: condition, allow/deny (or both) lists. Condition is using
<a href=/doc/feature/query>package query</a> syntax, but it matches agains <code>.changes</code> file fields. If condition
part of the rule matches <code>.changes</code> file, search stops and rule is processed:</p><ul><li>if any of keys which have been used to sign <code>.changes</code> file match <code>deny</code> list, upload would be rejected</li><li>if any of keys which have been used to sign <code>.changes</code> file match <code>allow</code> list, upload would be accepted</li></ul><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")return;var t,n,s,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="aptly",n="aptly repo include",s="/doc/aptly/repo/include/".replace(/\/$/,""),e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div></div></section><footer id=page-footer><div class=container><nav class="navbar navbar-default navbar-static-top" role=navigation><ul class="nav navbar-nav nav-justified"><li><a href=/tutorial/>tutorials</a></li><li><a href=/download/>download</a></li><li><a href=/support/>support</a></li><li class=active><a href=/doc/overview/>documentation</a></li><li><a href=/about/>about</a></li><li><a href=/post/>blog</a></li></ul></nav><div class=copy>Sponsored by <a href=http://express42.com/>express42</a> &copy;&nbsp;2013-2018 aptly contributors</div></div></footer><script src=https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js></script>
<script src=/js/bootstrap.min.js></script>
<script src=/js/aptly.js></script>
<script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-6065617-2","aptly.info"),ga("send","pageview")</script></body></html>