<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title>aptly - FAQ</title>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel="shortcut icon" href=/favicon.ico>
<link type=text/css rel=stylesheet href=/css/styles.css>
<link rel=canonical href=https://www.aptly.info/doc/faq/>
<link href=/post/index.xml rel=alternate type=application/rss+xml title="Debian repository management tool">
</head>
<body>
<header id=page-header>
<div class=container>
<nav class="navbar navbar-default navbar-static-top" role=navigation>
<ul class="nav navbar-nav nav-justified">
<li><a href=/tutorial/>tutorials</a></li>
<li><a href=/download/>download</a></li>
<li><a href=/support/>support</a></li>
<li class=active><a href=/doc/overview/>documentation</a></li>
<li><a href=/about/>about</a></li>
<li><a href=/post/>blog</a></li>
</ul>
</nav>
<div class=row>
<div class="col-md-6 col-md-offset-3 text-center">
<a class=brand href=/>
<i class=brand-logo></i>
<span class=brand-name>aptly</span>
</a>
</div>
</div>
</div>
</header>
<section class=documentation>
<div class=container>
<div class=sidebar-overlay></div>
<div class=row>
<div class="col-md-3 col-sm-3 col-xs-3">
<div class=sidebar>
<ul class="nav nav-sidebar">
<li>
<a href=/doc/overview/>Overview</a>
</li>
<li>
<a href=/doc/why/>Why aptly?</a>
</li>
<li class=active>
<a href=/doc/faq/>FAQ</a>
</li>
<li>
<a href=/doc/features/>Features</a>
<ul class=nav>
<li>
<a href=/doc/feature/query/>Package Queries</a>
</li>
<li>
<a href=/doc/feature/duplicate/>Duplicate Packages</a>
</li>
<li>
<a href=/doc/feature/s3/>Publishing to S3</a>
</li>
<li>
<a href=/doc/feature/swift/>Publishing to Swift</a>
</li>
<li>
<a href=/doc/feature/filesystem/>Filesystem Publishing</a>
</li>
<li>
<a href=/doc/feature/multi-component/>Multi-Component Publishing</a>
</li>
<li>
<a href=/doc/feature/pgp-providers/>PGP Providers</a>
</li>
<li>
<a href=/doc/feature/package-display/>Package Display Format</a>
</li>
<li>
<a href=/doc/feature/dependencies/>Dependency Resolving</a>
</li>
</ul>
</li>
<li>
<a href=/doc/configuration/>Configuration</a>
</li>
<li>
<a href=/doc/commands/>Commands</a>
<ul class=nav>
<li>
<a href=/doc/aptly/flags/>Global Flags</a>
</li>
<li>
<a href=/doc/aptly/mirror/>aptly mirror</a>
<ul class=nav>
<li>
<a href=/doc/aptly/mirror/create/>aptly mirror create</a>
</li>
<li>
<a href=/doc/aptly/mirror/update/>aptly mirror update</a>
</li>
<li>
<a href=/doc/aptly/mirror/list/>aptly mirror list</a>
</li>
<li>
<a href=/doc/aptly/mirror/show/>aptly mirror show</a>
</li>
<li>
<a href=/doc/aptly/mirror/edit/>aptly mirror edit</a>
</li>
<li>
<a href=/doc/aptly/mirror/search/>aptly mirror search</a>
</li>
<li>
<a href=/doc/aptly/mirror/rename/>aptly mirror rename</a>
</li>
<li>
<a href=/doc/aptly/mirror/drop/>aptly mirror drop</a>
</li>
</ul>
</li>
<li>
<a href=/doc/aptly/repo/>aptly repo</a>
<ul class=nav>
<li>
<a href=/doc/aptly/repo/create/>aptly repo create</a>
</li>
<li>
<a href=/doc/aptly/repo/add/>aptly repo add</a>
</li>
<li>
<a href=/doc/aptly/repo/include/>aptly repo include</a>
</li>
<li>
<a href=/doc/aptly/repo/import/>aptly repo import</a>
</li>
<li>
<a href=/doc/aptly/repo/show/>aptly repo show</a>
</li>
<li>
<a href=/doc/aptly/repo/list/>aptly repo list</a>
</li>
<li>
<a href=/doc/aptly/repo/copy/>aptly repo copy</a>
</li>
<li>
<a href=/doc/aptly/repo/move/>aptly repo move</a>
</li>
<li>
<a href=/doc/aptly/repo/remove/>aptly repo remove</a>
</li>
<li>
<a href=/doc/aptly/repo/search/>aptly repo search</a>
</li>
<li>
<a href=/doc/aptly/repo/edit/>aptly repo edit</a>
</li>
<li>
<a href=/doc/aptly/repo/rename/>aptly repo rename</a>
</li>
<li>
<a href=/doc/aptly/repo/drop/>aptly repo drop</a>
</li>
</ul>
</li>
<li>
<a href=/doc/aptly/snapshot/>aptly snapshot</a>
<ul class=nav>
<li>
<a href=/doc/aptly/snapshot/create/>aptly snapshot create</a>
</li>
<li>
<a href=/doc/aptly/snapshot/list/>aptly snapshot list</a>
</li>
<li>
<a href=/doc/aptly/snapshot/show/>aptly snapshot show</a>
</li>
<li>
<a href=/doc/aptly/snapshot/verify/>aptly snapshot verify</a>
</li>
<li>
<a href=/doc/aptly/snapshot/pull/>aptly snapshot pull</a>
</li>
<li>
<a href=/doc/aptly/snapshot/filter/>aptly snapshot filter</a>
</li>
<li>
<a href=/doc/aptly/snapshot/diff/>aptly snapshot diff</a>
</li>
<li>
<a href=/doc/aptly/snapshot/merge/>aptly snapshot merge</a>
</li>
<li>
<a href=/doc/aptly/snapshot/search/>aptly snapshot search</a>
</li>
<li>
<a href=/doc/aptly/snapshot/rename/>aptly snapshot rename</a>
</li>
<li>
<a href=/doc/aptly/snapshot/drop/>aptly snapshot drop</a>
</li>
</ul>
</li>
<li>
<a href=/doc/aptly/package/>aptly package</a>
<ul class=nav>
<li>
<a href=/doc/aptly/package/search/>aptly package search</a>
</li>
<li>
<a href=/doc/aptly/package/show/>aptly package show</a>
</li>
</ul>
</li>
<li>
<a href=/doc/aptly/publish/>aptly publish</a>
<ul class=nav>
<li>
<a href=/doc/aptly/publish/snapshot/>aptly publish snapshot</a>
</li>
<li>
<a href=/doc/aptly/publish/repo/>aptly publish repo</a>
</li>
<li>
<a href=/doc/aptly/publish/update/>aptly publish update</a>
</li>
<li>
<a href=/doc/aptly/publish/switch/>aptly publish switch</a>
</li>
<li>
<a href=/doc/aptly/publish/list/>aptly publish list</a>
</li>
<li>
<a href=/doc/aptly/publish/show/>aptly publish show</a>
</li>
<li>
<a href=/doc/aptly/publish/drop/>aptly publish drop</a>
</li>
</ul>
</li>
<li>
<a href=/doc/aptly/db/>aptly db</a>
<ul class=nav>
<li>
<a href=/doc/aptly/db/cleanup/>aptly db cleanup</a>
</li>
<li>
<a href=/doc/aptly/db/recover/>aptly db recover</a>
</li>
</ul>
</li>
<li>
<a href=/doc/aptly/task/>aptly task</a>
<ul class=nav>
<li>
<a href=/doc/aptly/task/run/>aptly task run</a>
</li>
</ul>
</li>
<li>
<a href=/doc/aptly/serve/>aptly serve</a>
</li>
<li>
<a href=/doc/aptly/config/>aptly config</a>
<ul class=nav>
<li>
<a href=/doc/aptly/config/show/>aptly config show</a>
</li>
</ul>
</li>
<li>
<a href=/doc/aptly/graph/>aptly graph</a>
</li>
</ul>
</li>
<li>
<a href=/doc/api/>API</a>
<ul class=nav>
<li>
<a href=/doc/api/repos/>Local Repos API</a>
</li>
<li>
<a href=/doc/api/files/>File Upload API</a>
</li>
<li>
<a href=/doc/api/snapshots/>Snapshot API</a>
</li>
<li>
<a href=/doc/api/publish/>Publish API</a>
</li>
<li>
<a href=/doc/api/packages/>Package API</a>
</li>
<li>
<a href=/doc/api/misc/>Misc API</a>
</li>
</ul>
</li>
<li>
<a href=/doc/integrations/>Integrations</a>
</li>
</ul>
<div class=source-buttons>
<a href=/download/ class="btn btn-danger">Download</a>
<a href=https://github.com/aptly-dev/aptly class="btn btn-default">Github</a>
</div>
</div>
</div>
<div class="col-md-9 col-sm-9 col-xs-9">
<h2 id=frequently-asked-questions>Frequently Asked Questions</h2>
<p><strong>Q: Why does aptly look for uncompressed <code>Package</code> file and fails?</strong></p>
<p>Output from aptly looks like that:</p>
<pre><code>Downloading http://ubuntu.osuosl.org/ubuntu/dists/trusty/universe/binary-arm64/Packages.bz2...
Downloading http://ubuntu.osuosl.org/ubuntu/dists/trusty/universe/binary-arm64/Packages.gz...
Downloading http://ubuntu.osuosl.org/ubuntu/dists/trusty/universe/binary-arm64/Packages...
ERROR: unable to update: HTTP code 404 while fetching http://ubuntu.osuosl.org/ubuntu/dists/trusty/universe/binary-arm64/Packages
</code></pre>
<p>Most probably mirror is broken or Packages files is missing completely. aptly first tries to
download compressed version of <code>Packages</code> file, then falls back to uncompressed version. If none
were found (or failed to download), aptly would display error message.</p>
<p><strong>Q: How do I mirror multi-component repository preserving components?</strong></p>
<p>Please see <a href=/doc/feature/multi-component/>multi-component publishing</a>.</p>
<p><strong>Q: How do I publish multi-component repository?</strong></p>
<p>Please see <a href=/doc/feature/multi-component/>multi-component publishing</a>.</p>
<p><strong>Q: How can I switch mirror from one HTTP URL to another?</strong></p>
<p>aptly stores package files in deduplicated way in the package pool (by default in directory <code>~/.aptly/pool</code>).
You can <a href=/doc/aptly/mirror/create/>create new mirror</a> with new HTTP source URL and
<a href=/doc/aptly/mirror/update>update it</a>: aptly won&rsquo;t download any files if they&rsquo;re
already available in the pool.</p>
<p><strong>Q: Why does published repository miss source packages?</strong></p>
<p>When repository is first published, list of architectures is stored in the database
and can&rsquo;t be changed. By default aptly would guess list of architectures from the
contents of the snapshot or local repository being published. If it doesn&rsquo;t contain
source packages at the moment of publishing, aptly would never publish them even
when repository is updated or snapshots is switched. In order to include source
packages, specify explicit list of architectures when publishing:</p>
<pre><code>$ aptly publish snapshot -architectures=md5,source my-snapshot-1
</code></pre>
<p><strong>Q: How do I add packages with different components to local repository?</strong></p>
<p>Please see <a href=/doc/feature/multi-component/>multi-component publishing</a>.</p>
<p><strong>Q: How to automate entering GPG key passphrase with aptly?</strong></p>
<p>If you publish packages from some kind of automation tool (e.g. from continuous integration
service), it is not possible to enter passphrase manually. There are two possible workarounds,
both of them compromise on security: create key without passphrase or pass passphrase via
aptly flags when publishing.</p>
<p><em>Key without passphrase</em>. To create such key,
create <code>gpg</code> batch file <code>foo</code> with following content:</p>
<pre><code>%echo Generating a default key
Key-Type: default
Subkey-Type: default
Name-Real: Joe Tester
Name-Comment: with stupid passphrase
Name-Email: joe@foo.bar
Expire-Date: 0
%pubring foo.pub
%secring foo.sec
# Do a commit here, so that we can later print &quot;done&quot; :-)
%commit
%echo done
</code></pre>
<p>And run <code>gpg</code>:</p>
<pre><code>$ gpg --batch --gen-key foo
</code></pre>
<p>More information could be found in <a href=https://www.gnupg.org/documentation/manuals/gnupg-devel/Unattended-GPG-key-generation.html>GnuPG manual</a>.</p>
<p><em>Passing passphrase when publishing</em>. Create key as usual, and add flags <code>-passphrase=</code> or
<code>-passphrase-file=</code> to aptly publishing commands. Flag values would be passed to corresponding GnuPG
flags. Contents of command line could be visible to other users on multi-user system, while contents
of the file with passphrase could be readable by other users. So use these options with caution.</p>
<p><strong>Q: Why does PXE installing of Debian fails with repository published by aptly?</strong></p>
<p>Debian installer requires <code>.udeb</code> packages, they can be mirrored from main Debian repository
with flag <code>-with-udebs</code> to <a href=/doc/aptly/mirror/create><code>aptly mirror create</code></a> command. aptly
would sign repository with your GPG key, so you might need to modify installer to accept
your custom key.</p>
<p><strong>Q: Can I preserve Debian signing key when mirroring?</strong></p>
<p>When mirroring, snapshotting and publishing, aptly signs the resulting published repository
with GPG key. As you don&rsquo;t own official Debian GPG key, you can&rsquo;t sign with it. While publishing
repository, aptly re-generates metadata files, so original signature won&rsquo;t work.</p>
<p>aptly doesn&rsquo;t yet support <a href=https://github.com/aptly-dev/aptly/issues/37>direct mirroring</a>
(publishing original metadata files), so currently there&rsquo;s no way to preserve Debian signing key.</p>
<p><strong>Q: I&rsquo;ve created snapshot <code>-foo</code> and now I can&rsquo;t even drop it!</strong></p>
<p>Snapshot (mirror, local repository names) could be confused with flags if they start with
dash. Please use two dashes (<code>--</code>) to separate flags from arguments:</p>
<pre><code>$ aptly snapshot rename -- -foo my-foo
</code></pre>
<p><strong>Q: Why does aptly ignore config file <code>/etc/aptly.conf</code>?</strong></p>
<p>aptly first looks for configuration file in <code>~/.aptly.conf</code>, and if no file is found, it
makes attempt to load <code>/etc/aptly.conf</code>. aptly creates configuration file in <code>~/.aptly.conf</code>
if no config file is found, so you might need to remove auto-generated <code>~/.aptly.conf</code>.</p>
<p><strong>Q: How do I change permissions for published repository files?</strong></p>
<p>aptly creates files with permission <code>0666</code> and directories with permission <code>0777</code>, permissions
are affected by user&rsquo;s <a href=http://en.wikipedia.org/wiki/Umask>umask</a> setting. With default umask
of <code>0022</code>, files created would have permissions <code>-rw-r--r--</code> and dirs would be <code>drwxr-xr-x</code>.
So change umask before running <code>aptly publish</code> in order to set final permissions as you need.</p>
<p><strong>Q: Why does apt-get fail to download packages published to S3 with <code>+</code> in filenames?</strong></p>
<p>This is a result of somewhat non-standard behavior of Amazon S3 API related to encoding
of <code>+</code> character. This has been fixed in <code>apt</code> version 0.9.9.1. If you have older version
of <code>apt</code>, you can enable workaround in aptly with option <a href=/doc/feature/s3/><code>plusWorkaround</code></a>.</p>
<p><strong>Q: How do I secure API access to aptly?</strong></p>
<p>Most easy way to protect the aptly remote API is to place it behind a reverse proxy like nginx or Apache and leverage their capabilities.</p>
<p><em>nginx</em> Example:</p>
<p>Most of this is misc. nginx and ssl setup, interesting bits are tagged with <code>###</code>.</p>
<pre tabindex=0><code>server {
	listen 80;
	server_name your.repo.org ;
	
	### rewrite all non https traffic
	location /api/ {
		rewrite ^/(.*)$ https://$server_name$request_uri permanent;
	}
	root /nowhere;
	### end of rewrite
}
server {
	server_name your.repo.org;
	ssl on;
	listen 443 ssl http2;
	ssl_certificate ...
	ssl_certificate_key ...
	ssl_protocols ...
	ssl_ciphers ...
	ssl_prefer_server_ciphers on;
	root /nowhere;
	location ~ /\.ht {
		deny all;
	}
	### protect /api with basic auth
	location /api/ {
		client_max_body_size 100M;
		auth_basic &quot;Restricted&quot;;
		auth_basic_user_file /etc/nginx/.htpasswd.aptly;
		proxy_redirect	off;
		proxy_pass	http://localhost:8080/api/;
		proxy_redirect	http://localhost:8080/api/ /api;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $remote_addr;
		proxy_set_header X-Forwarded-Proto $scheme;
		proxy_set_header Host $http_host;
		proxy_set_header Origin &quot;&quot;;
	}
	### end of api protection
}
</code></pre><p>You can create a <em>.htpasswd</em> file using <em>htpasswd</em></p>
<pre tabindex=0><code>apt-get install apache2-utils -y
htpasswd -c /etc/nginx/.htpasswd.aptly repo-api
chmod o-rw /etc/nginx/.htpasswd.aptly
chown www-data: /etc/nginx/.htpasswd.aptly
</code></pre><p>Now you can add users without <code>-c</code> flag.</p>
<div id=disqus_thread></div>
<script type=text/javascript>(function(){var a,b,c,d;if(window.location.hostname=="localhost")return;a=document.createElement('script'),a.type='text/javascript',a.async=!0,b='aptly',c='FAQ',d='/doc/faq/'.replace(/\/$/,""),a.src='//'+b+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
</div>
</div>
</div>
</section>
<footer id=page-footer>
<div class=container>
<nav class="navbar navbar-default navbar-static-top" role=navigation>
<ul class="nav navbar-nav nav-justified">
<li><a href=/tutorial/>tutorials</a></li>
<li><a href=/download/>download</a></li>
<li><a href=/support/>support</a></li>
<li class=active><a href=/doc/overview/>documentation</a></li>
<li><a href=/about/>about</a></li>
<li><a href=/post/>blog</a></li>
</ul>
</nav>
<div class=copy>
Sponsored by <a href=http://express42.com/>express42</a> &copy;&nbsp;2013-2018 aptly contributors
</div>
</div>
</footer>
<script src=https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js></script>
<script src=/js/bootstrap.min.js></script>
<script src=/js/aptly.js></script>
<script>(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)})(window,document,'script','//www.google-analytics.com/analytics.js','ga'),ga('create','UA-6065617-2','aptly.info'),ga('send','pageview')</script>
</body>
</html>