<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>aptly mirror create</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="/favicon.ico">
    <link type="text/css" rel="stylesheet" href="/css/styles.css">
    <link rel="canonical" href="http://localhost:1313/doc/aptly/mirror/create">
    <link href="" rel="alternate" type="application/rss+xml" title="aptly - Debian repository management tool" />
    
  </head>
  <body>
    <header id="page-header">
      <div class="container">
                <nav class="navbar navbar-default navbar-static-top" role="navigation">
          <ul class="nav navbar-nav nav-justified">
            <li><a href="/examples/">examples</a> doc</li>
            <li ><a href="/download/">download</a></li>
            <li><a href="/support/">support</a></li>
            <li class="active"><a href="/doc/">documentation</a></li>
            <li ><a href="/about/">about</a></li>
            <li ><a href="/post/">blog</a></li>
          </ul>
        </nav>

        <div class="row">
          <div class="col-md-6 col-md-offset-3 text-center">
            <div class="brand">
              <i class="brand-logo"></i>
              <span class="brand-name">aptly</span>
            </div>
          </div>
        </div>
      
      </div>
    </header>

    
    <section class="documentation">
      <div class="container">
        <div class="sidebar-overlay"></div>
        <div class="row">
          <div class="col-md-3 col-sm-3 col-xs-3">
            <div class="sidebar">
              <ul class="nav nav-sidebar">
                
                
                  <li >
                    <a href="http://localhost:1313/doc/overview">Overview</a>
                    
                  </li>
                
                  <li >
                    <a href="http://localhost:1313/doc/why">Why aptly?</a>
                    
                  </li>
                
                  <li >
                    <a href="http://localhost:1313/doc/commands">Commands</a>
                    
                      <ul class="nav">
                        
                          <li class="active">
                            <a href="http://localhost:1313/doc/aptly/mirror">aptly mirror</a>
                            
                              <ul class="nav">
                                
                                  <li class="active">
                                    <a href="http://localhost:1313/doc/aptly/mirror/create">aptly mirror create</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/mirror/update">aptly mirror update</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/mirror/list">aptly mirror list</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/mirror/show">aptly mirror show</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/mirror/edit">aptly mirror edit</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/mirror/rename">aptly mirror rename</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/mirror/drop">aptly mirror drop</a>
                                  </li>
                                
                              </ul>
                            
                          </li>
                        
                          <li >
                            <a href="http://localhost:1313/doc/aptly/repo">aptly repo</a>
                            
                              <ul class="nav">
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/repo/create">aptly repo create</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/repo/add">aptly repo add</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/repo/import">aptly repo import</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/repo/show">aptly repo show</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/repo/list">aptly repo list</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/repo/copy">aptly repo copy</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/repo/move">aptly repo move</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/repo/remove">aptly repo remove</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/repo/edit">aptly repo edit</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/repo/rename">aptly repo rename</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/repo/drop">aptly repo drop</a>
                                  </li>
                                
                              </ul>
                            
                          </li>
                        
                          <li >
                            <a href="http://localhost:1313/doc/aptly/snapshot">aptly snapshot</a>
                            
                              <ul class="nav">
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/snapshot/create">aptly snapshot create</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/snapshot/list">aptly snapshot list</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/snapshot/show">aptly snapshot show</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/snapshot/verify">aptly snapshot verify</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/snapshot/pull">aptly snapshot pull</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/snapshot/diff">aptly snapshot diff</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/snapshot/merge">aptly snapshot merge</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/snapshot/rename">aptly snapshot rename</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/snapshot/drop">aptly snapshot drop</a>
                                  </li>
                                
                              </ul>
                            
                          </li>
                        
                          <li >
                            <a href="http://localhost:1313/doc/aptly/publish">aptly publish</a>
                            
                              <ul class="nav">
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/publish/snapshot">aptly publish snapshot</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/publish/repo">aptly publish repo</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/publish/update">aptly publish update</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/publish/switch">aptly publish switch</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/publish/list">aptly publish list</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/publish/drop">aptly publish drop</a>
                                  </li>
                                
                              </ul>
                            
                          </li>
                        
                          <li >
                            <a href="http://localhost:1313/doc/aptly/db">aptly db</a>
                            
                              <ul class="nav">
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/db/cleanup">aptly db cleanup</a>
                                  </li>
                                
                                  <li >
                                    <a href="http://localhost:1313/doc/aptly/db/recover">aptly db recover</a>
                                  </li>
                                
                              </ul>
                            
                          </li>
                        
                          <li >
                            <a href="http://localhost:1313/doc/aptly/serve">aptly serve</a>
                            
                          </li>
                        
                          <li >
                            <a href="http://localhost:1313/doc/aptly/graph">aptly graph</a>
                            
                          </li>
                        
                      </ul>
                    
                  </li>
                
                  <li >
                    <a href="http://localhost:1313/doc/history">History</a>
                    
                  </li>
                
              </ul>
              <div class="source-buttons">
                <a href="/download/" class="btn btn-danger">Download</a>
                <a href="https://github.com/smira/aptly" class="btn btn-default">Github</a>
              </div>
            </div>
          </div>
          <div class="col-md-9 col-sm-9 col-xs-9">
            

<h2 id="toc_0">aptly mirror create</h2>

<p>Creates mirror of remote repository, aptly supports both regular and
flat Debian repositories exported via HTTP. aptly would try download
Release file from remote repository and verify its signature.</p>

<p>Usage:</p>

<pre><code>$  aptly mirror create &lt;name&gt; &lt;archive url&gt; &lt;distribution&gt; [&lt;component1&gt; ...]
</code></pre>

<p>For Launchpad PPAs:</p>

<pre><code>$  aptly mirror create &lt;name&gt; &lt;ppa:user/project&gt;
</code></pre>

<p>Params are:</p>

<ul>
<li><code>name</code> is a name that would be used in aptly to reference this
mirror</li>
<li><code>archive url</code> is a root of archive, e.g.
<a href="http://ftp.ru.debian.org/debian/">http://ftp.ru.debian.org/debian/</a></li>
<li><code>distribution</code> is a distribution name, e.g. <code>squeeze</code>, for flat
repositories use <code>./</code> instead of distribution name</li>
<li><code>component1</code> is an optional list of components to download, if not
specified aptly would fetch all components, e.g. <code>main</code></li>
</ul>

<p>Flags:</p>

<ul>
<li><code>-filter=</code>: <a href="#package-query">package query</a> that is applied to
packages in the mirror</li>
<li><code>-filter-with-deps=false</code>: when filtering, include dependencies of
matching packages as well</li>
<li><code>-ignore-signatures=false</code>: disable verification of Release file
signatures</li>
<li><code>-keyring=trustedkeys.gpg</code>: gpg keyring to use when verifying
Release file (could be specified multiple times)</li>
<li><code>-with-sources=false</code>: download source packages in addition to
binary packages (could be enabled by default with config option
<code>downloadSourcePackages</code>)</li>
</ul>

<p>By default aptly would download packages for all available
architectures. If architectures are limited (with config <code>architectures</code>
or option <code>-architectures</code>), only packages for those architectures are
downloaded</p>

<p>If components are not specified, aptly will download packages from all
components and merge it into one when publishing. If components should
be left separate, please create separate mirror for each component.</p>

<p>If PPA url is specified, aptly would expand it to HTTP url using
configuration options <code>ppaDistributorID</code> &amp; <code>ppaCodename</code>. If you&rsquo;re
running aptly on Ubuntu, defaults should work (aptly would figure out
codename using <code>lsb_release</code> command).</p>

<p>If filtering is enabled, all package lists are downloaded and filters
are applied to those lists. Only packages that match filter query would
be downloaded and filtered list would be contents of the mirror. If
dependency following is enabled, dependencies would be expanded in
filtered list to build resulting package list. Filters could be used to
limit mirror to only one package and its dependencies
(<code>-filter='nginx' -filter-follow-deps</code>), download only high-priority
packages (<code>-filter='Prirority (required)'</code>) and so on.</p>

<p>aptly would try to verify signature of Release files using GnuPG. By
default, keyring <code>~/.gnupg/trustedkeys.gpg</code> would be used. If you would
like to use different keyring(s), specify them using <code>-keyring</code> flag.
aptly would advise <code>gpg</code> commands to import keys into trusted keys
keyring in order to successfully verify repository signature.</p>

<p>If aptly is running on Debian/Ubuntu machine, it would be good to import
archive signing keys shipped with the operating system:</p>

<pre><code>$ gpg --keyring /usr/share/keyrings/debian-archive-keyring.gpg --export | gpg --no-default-keyring --keyring trustedkeys.gpg --import
</code></pre>

<p>If you&rsquo;re running Ubuntu, use
<code>/usr/share/keyrings/ubuntu-archive-keyring.gpg</code></p>

<p>If GnuPG is complaining that required key to verify signature is
missing, it would report key ID, e.g. <code>46925553</code>. Keys could be
downloaded from public keyserver and imported into trusted keyring using
command:</p>

<pre><code>$ gpg --no-default-keyring --keyring trustedkeys.gpg --keyserver keys.gnupg.net --recv-keys 46925553
</code></pre>

<p>Replace <code>46925553</code> with the key ID GnuPG is complaining about.</p>

<p>If you&rsquo;re mirroring flat repository, sometimes repository key is located
near release files, so you can download it and import into your trusted
keychain:</p>

<pre><code>$ wget -O - http://some.repo/repository/Release.key | gpg --no-default-keyring --keyring trustedkeys.gpg --import
</code></pre>

<p>You can learn about signed Debian repositories in <a href="https://wiki.debian.org/SecureApt">Debian
wiki</a>. If you would like to disable
signature checks, you can use flag <code>-ignore-signatures</code> or configuration
setting <code>gpgDisableVerify</code>.</p>

<p>aplty deduplicates all downloaded files, so if two mirrors are created
one with source packages enabled and another with source packages
disabled, they would consume only space required to store all binary and
source packages (not twice the space required to store binary packages).</p>

<p>Example:</p>

<pre><code>$ aptly -architectures=&quot;amd64&quot; mirror create debian-main http://ftp.ru.debian.org/debian/ squeeze main
2013/12/28 19:44:45 Downloading http://ftp.ru.debian.org/debian/dists/squeeze/Release...
...

Mirror [debian-main]: http://ftp.ru.debian.org/debian/ squeeze successfully added.
You can run 'aptly mirror update debian-main' to download repository contents.
</code></pre>

          </div>
        </div>
      </div>
    </section>
    
    <footer id="page-footer">
      <div class="container">
                <nav class="navbar navbar-default navbar-static-top" role="navigation">
          <ul class="nav navbar-nav nav-justified">
            <li><a href="/examples/">examples</a> doc</li>
            <li ><a href="/download/">download</a></li>
            <li><a href="/support/">support</a></li>
            <li class="active"><a href="/doc/">documentation</a></li>
            <li ><a href="/about/">about</a></li>
            <li ><a href="/post/">blog</a></li>
          </ul>
        </nav>

        <div class="copy">
          &copy;&nbsp;Andrey Smirnov
        </div>
      </div>
    </footer>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
  <script>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body>
</html>
