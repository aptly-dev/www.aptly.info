<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
      <title>Recent Content on aptly - Debian repository management tool </title>
      <generator uri="https://hugo.spf13.com">Hugo</generator>
    <link>http://www.aptly.info/index.xml</link>
    <language>en-us</language>
    <author>Andrey Smirnov</author>
    
    <updated>Fri, 10 Oct 2014 23:30:00 UTC</updated>
    
    <item>
      <title>Managing repositories of your packages</title>
      <link>http://www.aptly.info/tutorial/repo</link>
      <pubDate>Fri, 10 Oct 2014 23:30:00 UTC</pubDate>
      <author>Andrey Smirnov</author>
      <guid>http://www.aptly.info/tutorial/repo</guid>
      <description>

&lt;h2 id=&#34;toc_0&#34;&gt;Managing repositories of your packages&lt;/h2&gt;

&lt;p class=&#34;lead&#34;&gt;Goal: create repository with your own software as .deb packages,
publish it to Amazon S3, handle updates.&lt;/p&gt;

&lt;p&gt;In this tutorial I would describe how do I manage &lt;em&gt;aptly&lt;/em&gt; releases in repo.aptly.info repository using &lt;em&gt;aptly&lt;/em&gt; itself.&lt;/p&gt;

&lt;h3 id=&#34;toc_1&#34;&gt;Adding packages and creating snapshots&lt;/h3&gt;

&lt;p&gt;First, I create local repository that would hold all released versions of aptly:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly repo create -distribution=squeeze -component=main aptly-release

Local repo [aptly-release] successfully added.
You can run &#39;aptly repo add aptly-release ...&#39; to add packages to repository.
&lt;/pre&gt;

&lt;p&gt;While creating repository I&amp;rsquo;ve specified distribution and component names, that would be used
when I publish packages from this repository.&lt;/p&gt;

&lt;p&gt;As new versions of aptly are released, I add new &lt;code&gt;.deb&lt;/code&gt; packages by simply pointing aptly
to the directory with files:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly repo add aptly-release debs
Loading packages...
[+] aptly_0.8_amd64 added
[+] aptly_0.8_i386 added
&lt;/pre&gt;

&lt;p&gt;The repository holds all versions of aptly released so far:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly repo show -with-packages aptly-release
Name: aptly-release
Comment:
Default Distribution: squeeze
Default Component: main
Number of packages: 14
Packages:
  aptly_0.4.1_amd64
  aptly_0.5_amd64
  aptly_0.5.1_amd64
  aptly_0.6_amd64
  aptly_0.7_amd64
  aptly_0.7.1_amd64
  aptly_0.8_amd64
  aptly_0.4.1_i386
  aptly_0.5_i386
  aptly_0.5.1_i386
  aptly_0.6_i386
  aptly_0.7_i386
  aptly_0.7.1_i386
  aptly_0.8_i386
&lt;/pre&gt;

&lt;p&gt;After each major release, I create snapshot of local repository, so that I can &amp;ldquo;get back in time&amp;rdquo; to old
state of repository:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly snapshot create aptly-0.8 from repo aptly-release

Snapshot aptly-0.8 successfully created.
You can run &#39;aptly publish snapshot aptly-0.8&#39; to publish snapshot as Debian repository.

$ aptly snapshot list
List of snapshots:
 * [aptly-0.4.1]: Snapshot from local repo [aptly-release]
 * [aptly-0.5]: Snapshot from local repo [aptly-release]
 * [aptly-0.5.1]: Snapshot from local repo [aptly-release]
 * [aptly-0.6]: Snapshot from local repo [aptly-release]
 * [aptly-0.7]: Snapshot from local repo [aptly-release]
 * [aptly-0.7.1]: Snapshot from local repo [aptly-release]
 * [aptly-0.8]: Snapshot from local repo [aptly-release]

To get more information about snapshot, run `aptly snapshot show &lt;name&gt;`.
&lt;/pre&gt;

&lt;h3 id=&#34;toc_2&#34;&gt;Publishing to Amazon S3&lt;/h3&gt;

&lt;p&gt;I&amp;rsquo;ve chosen to Amazon S3 to host aptly package repository, as it is the easiest way to get reliable HTTP
hosting for static files.&lt;/p&gt;

&lt;p&gt;First, I&amp;rsquo;ve created S3 bucket &lt;code&gt;repo.aptly.info&lt;/code&gt; (name should match future domain name) using Amazon console, and
enabled website hosting. To the root of the bucket I&amp;rsquo;ve uploaded manually file &lt;code&gt;index.html&lt;/code&gt; with
some &lt;a href=&#34;http://repo.aptly.info/&#34;&gt;introductory notes&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Next, for security reasons it&amp;rsquo;s best to create separate user via Amazon IAM console that would do uploads
from aptly to S3. Save security credentials for the user into handy bash script &lt;code&gt;.aws.sh&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;export AWS_SECRET_ACCESS_KEY=&amp;quot;XXXXXXXXXXXXXXXXXXX&amp;quot;
export AWS_ACCESS_KEY_ID=&amp;quot;YYYYYYYYYYYYYYYYYYYY&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;And source this script in before performing any S3 operations from aptly:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ . .aws.sh
&lt;/pre&gt;

&lt;p&gt;For the user created, apply custom security policy:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{
  &amp;quot;Version&amp;quot;: &amp;quot;2012-10-17&amp;quot;,
  &amp;quot;Statement&amp;quot;: [
    {
      &amp;quot;Sid&amp;quot;: &amp;quot;Stmt1405592139000&amp;quot;,
      &amp;quot;Effect&amp;quot;: &amp;quot;Allow&amp;quot;,
      &amp;quot;Action&amp;quot;: [
        &amp;quot;s3:DeleteObject&amp;quot;,
        &amp;quot;s3:GetObject&amp;quot;,
        &amp;quot;s3:ListBucket&amp;quot;,
        &amp;quot;s3:PutObject&amp;quot;,
        &amp;quot;s3:PutObjectAcl&amp;quot;
      ],
      &amp;quot;Resource&amp;quot;: [
        &amp;quot;arn:aws:s3:::repo.aptly.info/*&amp;quot;, &amp;quot;arn:aws:s3:::repo.aptly.info&amp;quot;
      ]
    }
  ]
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;You would need to change &lt;code&gt;repo.aptly.info&lt;/code&gt; to the name of your S3 bucket. This policy allows limited
number of operations only on one bucket, which should be pretty safe.&lt;/p&gt;

&lt;p&gt;Final piece: setup your DNS name to point to S3, more information in &lt;a href=&#34;http://docs.aws.amazon.com/AmazonS3/latest/dev/website-hosting-custom-domain-walkthrough.html&#34;&gt;Amazon S3 docs&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;So the only thing left is to setup aptly to use that S3 bucket for publishing. I edit &lt;code&gt;~/.aptly.conf&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{
   &amp;quot;architectures&amp;quot;:[],
   ....
   &amp;quot;S3PublishEndpoints&amp;quot;:{
      &amp;quot;repo.aptly.info&amp;quot;:{
         &amp;quot;region&amp;quot;:&amp;quot;us-east-1&amp;quot;,
         &amp;quot;bucket&amp;quot;:&amp;quot;repo.aptly.info&amp;quot;,
         &amp;quot;acl&amp;quot;:&amp;quot;public-read&amp;quot;
      }
   }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;In &lt;code&gt;S3PublishEndpoints&lt;/code&gt; section I add new entry &lt;code&gt;repo.aptly.info&lt;/code&gt; with bucket name, region (you choose region when creating the bucket) and &lt;code&gt;public-read&lt;/code&gt; acl. By default aptly publishes files with &lt;code&gt;private&lt;/code&gt; acl which doesn&amp;rsquo;t work for me, as I&amp;rsquo;m
creating public repo.&lt;/p&gt;

&lt;p&gt;So now I can publish to S3 with aptly. I&amp;rsquo;m publishing latest snapshot, &lt;code&gt;aptly-0.8&lt;/code&gt;. I could have published repository &lt;code&gt;aptly-release&lt;/code&gt; directly, but doing via snapshot gives more flexibility: I can rollback to previous snapshot if things go wrong
for any reason.&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly publish snapshot aptly-0.8 s3:repo.aptly.info:
...
&lt;/pre&gt;

&lt;p&gt;aptly would upload package files to my S3 bucket, generate index files, do signing and so on. In the end &lt;code&gt;repo.aptly.info&lt;/code&gt;
holds complete Debian repository structure, and I can use it in apt sources:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;deb http://repo.aptly.info/ squeeze main
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;When next of aptly would be released, I would add new package to &lt;code&gt;aptly-release&lt;/code&gt; local repo, create snapshot &lt;code&gt;aptly-0.9&lt;/code&gt; and
switch S3 published repository to new version with following command:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly publish switch squeeze s3:repo.aptly.info: aptly-0.9
...
&lt;/pre&gt;

&lt;p&gt;Published repositories are referenced by distribution name (&lt;code&gt;squeeze&lt;/code&gt; in our case, taken from local repo defaults) and
prefix which includes storage engine (&lt;code&gt;s3:repo.aptly.info:&lt;/code&gt;).&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Pulling new versions of packages</title>
      <link>http://www.aptly.info/tutorial/pull</link>
      <pubDate>Fri, 10 Oct 2014 23:20:00 UTC</pubDate>
      <author>Andrey Smirnov</author>
      <guid>http://www.aptly.info/tutorial/pull</guid>
      <description>

&lt;h2 id=&#34;toc_0&#34;&gt;Pulling new versions of packages&lt;/h2&gt;

&lt;p class=&#34;lead&#34;&gt;Goal: pull new version of nginx package from backports, add aptly
package from 3rd party repository.&lt;/p&gt;

&lt;p&gt;Let&amp;rsquo;s start with mirrors created in &lt;a href=&#34;/tutorial/mirror/&#34;&gt;first tutorial&lt;/a&gt;: &lt;code&gt;wheezy-main&lt;/code&gt;,
&lt;code&gt;wheezy-updates&lt;/code&gt; and &lt;code&gt;wheezy-security&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&#34;toc_1&#34;&gt;Backporting nginx&lt;/h3&gt;

&lt;p&gt;Create new mirror &lt;code&gt;wheezy-backports&lt;/code&gt;:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly mirror create -architectures=amd64 -filter=nginx -filter-with-deps wheezy-backports http://ftp.ru.debian.org/debian/ wheezy-backports main
...

$ aptly mirror update wheezy-backports
Downloading http://ftp.ru.debian.org/debian/dists/wheezy-backports/InRelease...
gpgv: Signature made Thu 09 Oct 2014 02:49:29 PM UTC using RSA key ID 46925553
gpgv: Good signature from &#34;Debian Archive Automatic Signing Key (7.0/wheezy) &amp;lt;ftpmaster@debian.org&amp;gt;&#34;
Downloading &amp;amp; parsing package files...
Downloading http://ftp.ru.debian.org/debian/dists/wheezy-backports/main/binary-amd64/Packages.bz2...
Applying filter...
Packages filtered: 3290 -&gt; 10.
Building download queue...
Download queue: 10 items (2.45 MiB)
Downloading http://ftp.ru.debian.org/debian/pool/main/l/luajit/libluajit-5.1-2_2.0.3+dfsg-3~bpo70+1_amd64.deb...
Downloading http://ftp.ru.debian.org/debian/pool/main/n/nginx/nginx-full_1.6.2-1~bpo70+1_amd64.deb...
Downloading http://ftp.ru.debian.org/debian/pool/main/n/nginx/nginx-extras_1.6.2-1~bpo70+1_amd64.deb...
Downloading http://ftp.ru.debian.org/debian/pool/main/n/nginx/nginx-common_1.6.2-1~bpo70+1_all.deb...
Downloading http://ftp.ru.debian.org/debian/pool/main/l/luajit/libluajit-5.1-common_2.0.3+dfsg-3~bpo70+1_all.deb...
Downloading http://ftp.ru.debian.org/debian/pool/main/n/nginx/nginx-naxsi_1.6.2-1~bpo70+1_amd64.deb...
Downloading http://ftp.ru.debian.org/debian/pool/main/n/nginx/nginx-light_1.6.2-1~bpo70+1_amd64.deb...
Downloading http://ftp.ru.debian.org/debian/pool/main/i/init-system-helpers/init-system-helpers_1.18~bpo70+1_all.deb...
Downloading http://ftp.ru.debian.org/debian/pool/main/g/geoip/libgeoip1_1.5.0-3~bpo70+1_amd64.deb...
Downloading http://ftp.ru.debian.org/debian/pool/main/n/nginx/nginx_1.6.2-1~bpo70+1_all.deb...

Mirror `wheezy-backports` has been successfully updated.
&lt;/pre&gt;

&lt;p&gt;Once again, I&amp;rsquo;ve been using filters to reduce download size, but I could&amp;rsquo;ve create mirror without filter
covering whole wheezy-backports repostiroy.&lt;/p&gt;

&lt;p&gt;Create snapshot of that mirror:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly snapshot create wheezy-backports-20141009 from mirror wheezy-backports

Snapshot wheezy-backports-20141009 successfully created.
You can run &#39;aptly publish snapshot wheezy-backports-20141009&#39; to publish snapshot as Debian repository.
&lt;/pre&gt;

&lt;p&gt;The magic happens when I ask aptly to pull new version of &lt;code&gt;nginx&lt;/code&gt; package from &lt;code&gt;wheezy-backports&lt;/code&gt; snapshot
into my &lt;code&gt;wheezy-main&lt;/code&gt; snapshot:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly snapshot pull wheezy-final-20141009 wheezy-backports-20141009 wheezy-main-nginx-20141009 nginx
Dependencies would be pulled into snapshot:
    [wheezy-final-20141009]: Merged from sources: &#39;wheezy-main-7.6&#39;, &#39;wheezy-updates-20141009&#39;, &#39;wheezy-security-20141009&#39;
from snapshot:
    [wheezy-backports-20141009]: Snapshot from mirror [wheezy-backports]: http://ftp.ru.debian.org/debian/ wheezy-backports
and result would be saved as new snapshot wheezy-main-nginx-20141009.
Loading packages (327)...
Building indexes...
[+] init-system-helpers_1.18~bpo70+1_all added
[+] libluajit-5.1-2_2.0.3+dfsg-3~bpo70+1_amd64 added
[+] libluajit-5.1-common_2.0.3+dfsg-3~bpo70+1_all added
[-] nginx-naxsi-ui_1.2.1-2.2+wheezy3_all removed
[-] nginx_1.2.1-2.2+wheezy3_all removed
[+] nginx_1.6.2-1~bpo70+1_all added
[-] nginx-common_1.2.1-2.2+wheezy3_all removed
[+] nginx-common_1.6.2-1~bpo70+1_all added
[-] nginx-extras_1.2.1-2.2+wheezy3_amd64 removed
[+] nginx-extras_1.6.2-1~bpo70+1_amd64 added
[-] nginx-full_1.2.1-2.2+wheezy3_amd64 removed
[+] nginx-full_1.6.2-1~bpo70+1_amd64 added
[-] nginx-light_1.2.1-2.2+wheezy3_amd64 removed
[+] nginx-light_1.6.2-1~bpo70+1_amd64 added
[-] nginx-naxsi_1.2.1-2.2+wheezy3_amd64 removed
[+] nginx-naxsi_1.6.2-1~bpo70+1_amd64 added

Snapshot wheezy-main-nginx-20141009 successfully created.
You can run &#39;aptly publish snapshot wheezy-main-nginx-20141009&#39; to publish snapshot as Debian repository.
&lt;/pre&gt;

&lt;p&gt;As you can see, aptly has replaced not only &lt;code&gt;nginx&lt;/code&gt; package, but all its dependencies that required upgrade.
Now snapshot &lt;code&gt;wheezy-main-nginx-20141009&lt;/code&gt; is Debian wheezy 7.6 plus new version of nginx.&lt;/p&gt;

&lt;h3 id=&#34;toc_2&#34;&gt;Pulling aptly&lt;/h3&gt;

&lt;p&gt;In order to add latest version of aptly package from &lt;code&gt;repo.aptly.info&lt;/code&gt; mirror, create
and update mirror:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly mirror create aptly-repo http://repo.aptly.info/ squeeze
Downloading http://repo.aptly.info/dists/squeeze/InRelease...
gpgv: Signature made Fri 03 Oct 2014 02:35:18 PM UTC using RSA key ID 2A194991
gpgv: Good signature from &#34;Andrey Smirnov &amp;lt;me@smira.ru&amp;gt;&#34;

Mirror [aptly-repo]: http://repo.aptly.info/ squeeze successfully added.
You can run &#39;aptly mirror update aptly-repo&#39; to download repository contents.
$ aptly mirror update aptly-repo
Downloading http://repo.aptly.info/dists/squeeze/InRelease...
gpgv: Signature made Fri 03 Oct 2014 02:35:18 PM UTC using RSA key ID 2A194991
gpgv: Good signature from &#34;Andrey Smirnov &amp;lt;me@smira.ru&amp;gt;&#34;
Downloading &amp;amp; parsing package files...
Downloading http://repo.aptly.info/dists/squeeze/main/binary-amd64/Packages.bz2...
Downloading http://repo.aptly.info/dists/squeeze/main/binary-i386/Packages.bz2...
Building download queue...
Download queue: 14 items (47.29 MiB)
Downloading http://repo.aptly.info/pool/main/a/aptly/aptly_0.5_amd64.deb...
Downloading http://repo.aptly.info/pool/main/a/aptly/aptly_0.5_i386.deb...
Downloading http://repo.aptly.info/pool/main/a/aptly/aptly_0.6_amd64.deb...
Downloading http://repo.aptly.info/pool/main/a/aptly/aptly_0.6_i386.deb...
Downloading http://repo.aptly.info/pool/main/a/aptly/aptly_0.7.1_amd64.deb...
Downloading http://repo.aptly.info/pool/main/a/aptly/aptly_0.7.1_i386.deb...
Downloading http://repo.aptly.info/pool/main/a/aptly/aptly_0.7_amd64.deb...
Downloading http://repo.aptly.info/pool/main/a/aptly/aptly_0.7_i386.deb...
Downloading http://repo.aptly.info/pool/main/a/aptly/aptly_0.4.1_amd64.deb...
Downloading http://repo.aptly.info/pool/main/a/aptly/aptly_0.4.1_i386.deb...
Downloading http://repo.aptly.info/pool/main/a/aptly/aptly_0.8_amd64.deb...
Downloading http://repo.aptly.info/pool/main/a/aptly/aptly_0.8_i386.deb...
Downloading http://repo.aptly.info/pool/main/a/aptly/aptly_0.5.1_amd64.deb...
Downloading http://repo.aptly.info/pool/main/a/aptly/aptly_0.5.1_i386.deb...

Mirror `aptly-repo` has been successfully updated.
&lt;/pre&gt;

&lt;p&gt;In this case I haven&amp;rsquo;t limited architectures (so both &lt;code&gt;i386&lt;/code&gt; and &lt;code&gt;amd64&lt;/code&gt; were downloaded) and haven&amp;rsquo;t specified
component name: aptly can figure it out on its own.&lt;/p&gt;

&lt;p&gt;Next, create snapshot:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly snapshot create aptly-0.8 from mirror aptly-repo

Snapshot aptly-0.8 successfully created.
You can run &#39;aptly publish snapshot aptly-0.8&#39; to publish snapshot as Debian repository.
&lt;/pre&gt;

&lt;p&gt;And pull latest version of aptly from that snapshot into my &lt;code&gt;wheezy-main-nginx-20141009&lt;/code&gt; snapshot created
in previous section:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly snapshot pull wheezy-main-nginx-20141009 aptly-0.8 wheezy-main-nginx-aptly-20141009 aptly
Dependencies would be pulled into snapshot:
    [wheezy-main-nginx-20141009]: Pulled into &#39;wheezy-main-7.6&#39; with &#39;wheezy-backports-20141009&#39; as source, pull request was: &#39;nginx&#39;
from snapshot:
    [aptly-0.8]: Snapshot from mirror [aptly-repo]: http://repo.aptly.info/ squeeze
and result would be saved as new snapshot wheezy-main-nginx-aptly-20141009.
Loading packages (331)...
Building indexes...
[+] aptly_0.8_amd64 added

Snapshot wheezy-main-nginx-aptly-20141009 successfully created.
You can run &#39;aptly publish snapshot wheezy-main-nginx-aptly-20141009&#39; to publish snapshot as Debian repository.
&lt;/pre&gt;

&lt;p&gt;I haven&amp;rsquo;t specified version: aptly would choose latest version by default, also aptly is smart enough
to pull only &lt;code&gt;amd64&lt;/code&gt; package, as my snapshot &lt;code&gt;wheezy-main-nginx-20141009&lt;/code&gt; contains only &lt;code&gt;amd64&lt;/code&gt; packages.&lt;/p&gt;

&lt;h3 id=&#34;toc_3&#34;&gt;Publishing&lt;/h3&gt;

&lt;p&gt;So we&amp;rsquo;re ready to publish new snapshot as Debian repository. This time I would use two prefixes: one for stable
version of repository, which is well-tested, and another one for &amp;ldquo;testing&amp;rdquo; version that I would like to test
on small set of machines before deploying it fully.&lt;/p&gt;

&lt;p&gt;Publishing vanilla wheezy distribution from &lt;a href=&#34;/tutorial/mirror/&#34;&gt;mirroring tutorial&lt;/a&gt; as stable version:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly publish snapshot -distribution=wheezy wheezy-final-20141009 stable

...

Snapshot wheezy-final-20141009 has been successfully published.
Please setup your webserver to serve directory &#39;/home/smira/.aptly/public&#39; with autoindexing.
Now you can add following line to apt sources:
  deb http://your-server/stable/ wheezy main
Don&#39;t forget to add your GPG key to apt with apt-key.

You can also use `aptly serve` to publish your repositories over HTTP quickly.
&lt;/pre&gt;

&lt;p&gt;I&amp;rsquo;ve added one more argument on the command line, &lt;code&gt;stable&lt;/code&gt; which is publishing prefix (simply
subdirectory to publish under). Now the apt-sources line suggested by aptly contains
that prefix: &lt;code&gt;deb http://your-server/stable/ wheezy main&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;And I publish my wheezy + new nginx + aptly repository as testing version:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly publish snapshot -distribution=wheezy wheezy-main-nginx-aptly-20141009 testing

...

Snapshot wheezy-main-nginx-aptly-20141009 has been successfully published.
Please setup your webserver to serve directory &#39;/home/smira/.aptly/public&#39; with autoindexing.
Now you can add following line to apt sources:
  deb http://your-server/testing/ wheezy main
Don&#39;t forget to add your GPG key to apt with apt-key.

You can also use `aptly serve` to publish your repositories over HTTP quickly.
&lt;/pre&gt;

&lt;p&gt;I can verify that I have two published repos in different prefixes:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly serve
Serving published repositories, recommended apt sources list:

# stable/wheezy [amd64] publishes {main: [wheezy-final-20141009]: Merged from sources: &#39;wheezy-main-7.6&#39;, &#39;wheezy-updates-20141009&#39;, &#39;wheezy-security-20141009&#39;}
deb http://debian:8080/stable/ wheezy main
# testing/wheezy [amd64] publishes {main: [wheezy-main-nginx-aptly-20141009]: Pulled into &#39;wheezy-main-nginx-20141009&#39; with &#39;aptly-0.8&#39; as source, pull request was: &#39;aptly&#39;}
deb http://debian:8080/testing/ wheezy main
&lt;/pre&gt;

&lt;p&gt;After successful round of testing, I can use &lt;code&gt;aptly publish switch&lt;/code&gt; to switch by stable published repository
to the new snapshot &lt;code&gt;wheezy-main-nginx-aptly-20141009&lt;/code&gt; and update my target machines.&lt;/p&gt;

&lt;p&gt;If I generate the graph, it would look like that:&lt;/p&gt;

&lt;p&gt;&lt;img class=&#34;img-responsive&#34; src=&#34;/img/aptly-graph3.png&#34;&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Mirroring with snapshots</title>
      <link>http://www.aptly.info/tutorial/mirror</link>
      <pubDate>Thu, 09 Oct 2014 23:20:00 UTC</pubDate>
      <author>Andrey Smirnov</author>
      <guid>http://www.aptly.info/tutorial/mirror</guid>
      <description>

&lt;h2 id=&#34;toc_0&#34;&gt;Mirroring with snapshots&lt;/h2&gt;

&lt;p class=&#34;lead&#34;&gt;Goal: build mirror of Debian wheezy, with security updates incorporated,
done using snapshots to make package installation consistent on all the hosts.&lt;/p&gt;

&lt;h3 id=&#34;toc_1&#34;&gt;Preparation&lt;/h3&gt;

&lt;p&gt;First, &lt;a href=&#34;/download/&#34;&gt;install&lt;/a&gt; aptly. Please verify that you have aptly
dependencies installed: packages &lt;code&gt;bzip2&lt;/code&gt;, &lt;code&gt;gnupg&lt;/code&gt; and &lt;code&gt;gpgv&lt;/code&gt;.
Second, choose some user that would
be running all aptly commands (it shouldn&amp;rsquo;t be root user).&lt;/p&gt;

&lt;p&gt;We would be signing published repositories with our GPG key, so if you don&amp;rsquo;t
have GPG key yet, it&amp;rsquo;s time to create one:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ gpg --gen-key
gpg (GnuPG) 1.4.12; Copyright (C) 2012 Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Please select what kind of key you want:
   (1) RSA and RSA (default)
   (2) DSA and Elgamal
   (3) DSA (sign only)
   (4) RSA (sign only)
Your selection?
RSA keys may be between 1024 and 4096 bits long.
What keysize do you want? (2048)
Requested keysize is 2048 bits
Please specify how long the key should be valid.
         0 = key does not expire
      &lt;n&gt;  = key expires in n days
      &lt;n&gt;w = key expires in n weeks
      &lt;n&gt;m = key expires in n months
      &lt;n&gt;y = key expires in n years
Key is valid for? (0)
Key does not expire at all
Is this correct? (y/N) y

You need a user ID to identify your key; the software constructs the user ID
from the Real Name, Comment and Email Address in this form:
    &#34;Heinrich Heine (Der Dichter) &amp;lt;heinrichh@duesseldorf.de&amp;gt;&#34;

Real name: Andrey Smirnov
Email address: me@smira.ru
Comment: Signing repos
You selected this USER-ID:
    &#34;Andrey Smirnov (Signing repos) &amp;lt;me@smira.ru&amp;gt;&#34;

Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? O
You need a Passphrase to protect your secret key.

gpg: checking the trustdb
gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model
gpg: depth: 0  valid:   1  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 1u
pub   2048R/6430156A 2014-10-09
      Key fingerprint = 52EC DF0E EE8B 5DDF CC8F  7038 B9C8 F8B4 6430 156A
uid                  Andrey Smirnov (Signing repos) &amp;lt;me@smira.ru&amp;gt;
sub   2048R/E0C10001 2014-10-09
&lt;/pre&gt;

&lt;p&gt;Default options should be fine, you need to backup your key and prepare revocation
certificate, for examle like described &lt;a href=&#34;http://fedoraproject.org/wiki/Creating_GPG_Keys&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Now we&amp;rsquo;re ready to start!&lt;/p&gt;

&lt;h3 id=&#34;toc_2&#34;&gt;Creating Mirrors&lt;/h3&gt;

&lt;p&gt;Let&amp;rsquo;s assume that we need to mirror &lt;code&gt;wheezy&lt;/code&gt; (current stable) Debian distribution for architecture &lt;code&gt;amd64&lt;/code&gt;,
Only &lt;code&gt;main&lt;/code&gt; component is required and this repository is targeted for servers, not desktops.
Choose one of the Debian servers to download packages from the
&lt;a href=&#34;https://www.debian.org/mirror/list&#34;&gt;official list&lt;/a&gt;. Let it be &lt;code&gt;ftp.ru.debian.org&lt;/code&gt; in this tutorial.&lt;/p&gt;

&lt;p&gt;Create first mirror for &lt;code&gt;main&lt;/code&gt; component:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly mirror create -architectures=amd64 -filter=&#39;Priority (required) | Priority (important) | Priority (standard)&#39; wheezy-main http://ftp.ru.debian.org/debian/ wheezy main

Looks like your keyring with trusted keys is empty. You might consider importing some keys.
If you&#39;re running Debian or Ubuntu, it&#39;s a good idea to import current archive keys by running:

  gpg --keyring /usr/share/keyrings/debian-archive-keyring.gpg --export | gpg --no-default-keyring --keyring trustedkeys.gpg --import

(for Ubuntu, use /usr/share/keyrings/ubuntu-archive-keyring.gpg)

Downloading http://ftp.ru.debian.org/debian/dists/wheezy/InRelease...
Downloading http://ftp.ru.debian.org/debian/dists/wheezy/Release...
Downloading http://ftp.ru.debian.org/debian/dists/wheezy/Release.gpg...
gpgv: Signature made Sat 12 Jul 2014 10:59:56 AM UTC using RSA key ID 46925553
gpgv: Can&#39;t check signature: public key not found
gpgv: Signature made Sat 12 Jul 2014 11:04:06 AM UTC using RSA key ID 65FFB764
gpgv: Can&#39;t check signature: public key not found

Looks like some keys are missing in your trusted keyring, you may consider importing them from keyserver:

gpg --no-default-keyring --keyring trustedkeys.gpg --keyserver keys.gnupg.net --recv-keys 46925553 65FFB764

Sometimes keys are stored in repository root in file named Release.key, to import such key:

wget -O - http://some.repo/repository/Release.key | gpg --no-default-keyring --keyring trustedkeys.gpg --import

ERROR: unable to fetch mirror: verification of detached signature failed: exit status 2
&lt;/pre&gt;

&lt;p&gt;aptly is complaining about missing keys in our trusted keyring, as it&amp;rsquo;s not possible to verify authencity
of files being downloaded. Let&amp;rsquo;s follow the advice and import default Debian keyring:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ gpg --keyring /usr/share/keyrings/debian-archive-keyring.gpg --export | gpg --no-default-keyring --keyring trustedkeys.gpg --import
gpg: key 6430156A: public key &#34;Andrey Smirnov (Signing repos) &amp;lt;me@smira.ru&amp;gt;&#34; imported
gpg: key 2A194991: public key &#34;Andrey Smirnov &amp;lt;me@smira.ru&amp;gt;&#34; imported
gpg: key B98321F9: public key &#34;Squeeze Stable Release Key &amp;lt;debian-release@lists.debian.org&amp;gt;&#34; imported
gpg: key 473041FA: public key &#34;Debian Archive Automatic Signing Key (6.0/squeeze) &amp;lt;ftpmaster@debian.org&amp;gt;&#34; imported
gpg: key 65FFB764: public key &#34;Wheezy Stable Release Key &amp;lt;debian-release@lists.debian.org&amp;gt;&#34; imported
gpg: key 46925553: public key &#34;Debian Archive Automatic Signing Key (7.0/wheezy) &amp;lt;ftpmaster@debian.org&amp;gt;&#34; imported
gpg: Total number processed: 6
gpg:               imported: 6  (RSA: 6)
gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model
gpg: depth: 0  valid:   1  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 1u
&lt;/pre&gt;

&lt;p&gt;Now, let&amp;rsquo;s retry the mirror creation procedure:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly mirror create -architectures=amd64 -filter=&#39;Priority (required) | Priority (important) | Priority (standard) | nginx | postgresql | redis-server | memcached | ruby | golang&#39; -filter-with-deps wheezy-main http://ftp.ru.debian.org/debian/ wheezy main
Downloading http://ftp.ru.debian.org/debian/dists/wheezy/InRelease...
Downloading http://ftp.ru.debian.org/debian/dists/wheezy/Release...
Downloading http://ftp.ru.debian.org/debian/dists/wheezy/Release.gpg...
gpgv: Signature made Sat 12 Jul 2014 10:59:56 AM UTC using RSA key ID 46925553
gpgv: Good signature from &#34;Debian Archive Automatic Signing Key (7.0/wheezy) &amp;lt;ftpmaster@debian.org&amp;gt;&#34;
gpgv: Signature made Sat 12 Jul 2014 11:04:06 AM UTC using RSA key ID 65FFB764
gpgv: Good signature from &#34;Wheezy Stable Release Key &amp;lt;debian-release@lists.debian.org&amp;gt;&#34;

Mirror [wheezy-main]: http://ftp.ru.debian.org/debian/ wheezy successfully added.
You can run &#39;aptly mirror update wheezy-main&#39; to download repository contents.
&lt;/pre&gt;

&lt;p&gt;Now the signature has been verified: files in the mirror are signed with Debian key
(&lt;a href=&#34;https://ftp-master.debian.org/keys.html&#34;&gt;list of active keys&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;The flag &lt;code&gt;-filter=&lt;/code&gt; allows us to cut down number of packages to download. First part, &lt;code&gt;Priority (required) | Priority (important) | Priority (standard)&lt;/code&gt; is essential &amp;ldquo;base&amp;rdquo; Debian system, then several (virtual) packages are added that I
need: &lt;code&gt;nginx&lt;/code&gt;,  &lt;code&gt;postgresql&lt;/code&gt;, etc. Flag &lt;code&gt;-filter-with-deps&lt;/code&gt; instructs aptly to include dependencies of
matching packages as well. If filter is not specified, all packages would be included in the mirror and that would
require more space and download size would be bigger.&lt;/p&gt;

&lt;p&gt;Create also &lt;code&gt;wheezy-updates&lt;/code&gt; and &lt;code&gt;wheezy-security&lt;/code&gt; mirrors to get important updates:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly mirror create -architectures=amd64 -filter=&#39;Priority (required) | Priority (important) | Priority (standard) | nginx | postgresql | redis-server | memcached | ruby | golang&#39; -filter-with-deps wheezy-updates http://ftp.ru.debian.org/debian/ wheezy-updates main
...

$ aptly mirror create -architectures=amd64 -filter=&#39;Priority (required) | Priority (important) | Priority (standard) | nginx | postgresql | redis-server | memcached | ruby | golang&#39; -filter-with-deps wheezy-security http://security.debian.org/ wheezy/updates main
...
&lt;/pre&gt;

&lt;h3 id=&#34;toc_3&#34;&gt;Updating mirrors&lt;/h3&gt;

&lt;p&gt;Update &lt;code&gt;wheezy-main&lt;/code&gt; mirror for the first time:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly mirror update wheezy-main
Downloading http://ftp.ru.debian.org/debian/dists/wheezy/InRelease...
Downloading http://ftp.ru.debian.org/debian/dists/wheezy/Release...
Downloading http://ftp.ru.debian.org/debian/dists/wheezy/Release.gpg...
gpgv: Signature made Sat 12 Jul 2014 10:59:56 AM UTC using RSA key ID 46925553
gpgv: Good signature from &#34;Debian Archive Automatic Signing Key (7.0/wheezy) &amp;lt;ftpmaster@debian.org&amp;gt;&#34;
gpgv: Signature made Sat 12 Jul 2014 11:04:06 AM UTC using RSA key ID 65FFB764
gpgv: Good signature from &#34;Wheezy Stable Release Key &amp;lt;debian-release@lists.debian.org&amp;gt;&#34;
Downloading &amp;amp; parsing package files...
Downloading http://ftp.ru.debian.org/debian/dists/wheezy/main/binary-amd64/Packages.bz2...
Applying filter...
Packages filtered: 35933 -&gt; 304.
Building download queue...
Download queue: 304 items (147.18 MiB)
Downloading http://ftp.ru.debian.org/debian/pool/main/g/gnutls26/libgnutls26_2.12.20-8+deb7u2_amd64.deb...
Downloading http://ftp.ru.debian.org/debian/pool/main/e/eglibc/locales_2.13-38+deb7u2_all.deb...
Downloading http://ftp.ru.debian.org/debian/pool/main/p/perl/perl-modules_5.14.2-21+deb7u1_all.deb...
Downloading http://ftp.ru.debian.org/debian/pool/main/v/vim/vim-tiny_7.3.547-7_amd64.deb...
Downloading http://ftp.ru.debian.org/debian/pool/main/libt/libtext-iconv-perl/libtext-iconv-perl_1.7-5_amd64.deb...
....

Mirror `wheezy-main` has been successfully updated.
&lt;/pre&gt;

&lt;p&gt;Packages files have been downloaded to &lt;code&gt;~/.aptly/pool/&lt;/code&gt;, current mirror contents stored in the package database.
You can update mirror at any moment as required.&lt;/p&gt;

&lt;p&gt;And, for two other mirrors:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly mirror update wheezy-security
...

$ aptly mirror update wheezy-updates
...
&lt;/pre&gt;

&lt;h3 id=&#34;toc_4&#34;&gt;Taking snapshots&lt;/h3&gt;

&lt;p&gt;It&amp;rsquo;s time take snapshots of the mirrors to preserve &lt;em&gt;exact&lt;/em&gt; current mirror state. I will label snapshots
after mirror name, applying version for the main &lt;code&gt;wheezy&lt;/code&gt; mirror and current date for frequently updated
&lt;code&gt;security&lt;/code&gt; and &lt;code&gt;updates&lt;/code&gt; mirrors:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly snapshot create wheezy-main-7.6 from mirror wheezy-main

Snapshot wheezy-main-7.6 successfully created.
You can run &#39;aptly publish snapshot wheezy-main-7.6&#39; to publish snapshot as Debian repository.

$ aptly snapshot create wheezy-updates-20141009 from mirror wheezy-updates

Snapshot wheezy-updates-20141009 successfully created.
You can run &#39;aptly publish snapshot wheezy-updates-20141009&#39; to publish snapshot as Debian repository.

$ aptly snapshot create wheezy-security-20141009 from mirror wheezy-security

Snapshot wheezy-security-20141009 successfully created.
You can run &#39;aptly publish snapshot wheezy-security-20141009&#39; to publish snapshot as Debian repository.
&lt;/pre&gt;

&lt;p&gt;Snapshots are created instantly and they don&amp;rsquo;t occupy any extra space: only list of packages
is stored inside the snapshot.&lt;/p&gt;

&lt;h3 id=&#34;toc_5&#34;&gt;Merging snapshots&lt;/h3&gt;

&lt;p&gt;Now we can merge snapshots into one, producing &amp;ldquo;wheezy with security updates applied&amp;rdquo;:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly snapshot merge -latest wheezy-final-20141009 wheezy-main-7.6 wheezy-updates-20141009 wheezy-security-20141009

Snapshot wheezy-final-20141009 successfully created.
You can run &#39;aptly publish snapshot wheezy-final-20141009&#39; to publish snapshot as Debian repository.
&lt;/pre&gt;

&lt;p&gt;Flag &lt;code&gt;-latest&lt;/code&gt; chooses merge strategy: package with latest version &amp;ldquo;wins&amp;rdquo;.&lt;/p&gt;

&lt;p&gt;Let&amp;rsquo;s verify that merge was correct:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly package show -with-references &#39;Name (nginx)&#39;
Package: nginx
Version: 1.2.1-2.2+wheezy2
Installed-Size: 87
Priority: optional
Section: httpd
Maintainer: Kartik Mistry &amp;lt;kartik@debian.org&amp;gt;
Architecture: all
Description: small, powerful, scalable web/proxy server
MD5sum: fa5f86939aace1957b1fc846573cd2b1
SHA1: 05e521a9ec7854ed706aabcb0c0ea83fdee980d2
SHA256: 846905a046608aded2d29e05409ec3c0024717e6446cd0bdb544396a9652644d
Tag: implemented-in::c, interface::daemon, network::server, network::service,protocol::http, role::program, use::proxying
Description-md5: 19a4ea43e33eae4a46abf8a78966deb5
Source:
Filename: nginx_1.2.1-2.2+wheezy2_all.deb
Size: 61254
Depends: nginx-full | nginx-light
Homepage: http://nginx.net

References to package:
  mirror [wheezy-main]: http://ftp.ru.debian.org/debian/ wheezy
  snapshot [wheezy-main-7.6]: Snapshot from mirror [wheezy-main]: http://ftp.ru.debian.org/debian/ wheezy

Package: nginx
Version: 1.2.1-2.2+wheezy3
Installed-Size: 87
Priority: optional
Section: web
Maintainer: Kartik Mistry &amp;lt;kartik@debian.org&amp;gt;
Architecture: all
Description: small, powerful, scalable web/proxy server
MD5sum: 25ae5234388762babbfbe3632dbdcc57
SHA1: 34d7ff8f24cc47960688ae84d6d98f92275ad453
SHA256: 516d33cf93f20ca070a203bafacc6f7ceb04bd3ae221d5a9a59f90e2ab828245
Depends: nginx-full | nginx-light
Description-md5: 19a4ea43e33eae4a46abf8a78966deb5
Homepage: http://nginx.net
Source:
Filename: nginx_1.2.1-2.2+wheezy3_all.deb
Size: 61374

References to package:
  mirror [wheezy-security]: http://security.debian.org/ wheezy/updates
  snapshot [wheezy-final-20141009]: Merged from sources: &#39;wheezy-main-7.6&#39;, &#39;wheezy-updates-20141009&#39;, &#39;wheezy-security-20141009&#39;
  snapshot [wheezy-security-20141009]: Snapshot from mirror [wheezy-security]: http://security.debian.org/ wheezy/updates
&lt;/pre&gt;

&lt;p&gt;New version of &lt;code&gt;nginx&lt;/code&gt; package which came from &lt;code&gt;wheezy-security&lt;/code&gt; mirror is now part of our final snapshot
&lt;code&gt;wheezy-final-20141009&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&#34;toc_6&#34;&gt;PUBLISHING REPOSITORY&lt;/h3&gt;

&lt;p&gt;Final step: publishing our snapshot as Debian repository, ready to be consumed by &lt;code&gt;apt-get&lt;/code&gt;:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly publish snapshot wheezy-final-20141009
ERROR: unable to publish: unable to guess distribution name, please specify explicitly
&lt;/pre&gt;

&lt;p&gt;aptly complains that it can&amp;rsquo;t guess distribution name, as the source mirrors we had (main, security and
updates) all have different distribution names. So we need to help aptly a bit by supplying
distribution name:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly publish snapshot -distribution=wheezy wheezy-final-20141009
Loading packages...
Generating metadata files and linking package files...
Finalizing metadata files...
Signing file &#39;Release&#39; with gpg, please enter your passphrase when prompted:

You need a passphrase to unlock the secret key for
user: &#34;Andrey Smirnov (Signing repos) &amp;lt;me@smira.ru&amp;gt;&#34;
2048-bit RSA key, ID 6430156A, created 2014-10-09

Clearsigning file &#39;Release&#39; with gpg, please enter your passphrase when prompted:

You need a passphrase to unlock the secret key for
user: &#34;Andrey Smirnov (Signing repos) &amp;lt;me@smira.ru&amp;gt;&#34;
2048-bit RSA key, ID 6430156A, created 2014-10-09


Snapshot wheezy-final-20141009 has been successfully published.
Please setup your webserver to serve directory &#39;/home/smira/.aptly/public&#39; with autoindexing.
Now you can add following line to apt sources:
  deb http://your-server/ wheezy main
Don&#39;t forget to add your GPG key to apt with apt-key.

You can also use `aptly serve` to publish your repositories over HTTP quickly.
&lt;/pre&gt;

&lt;p&gt;The repository is published to &lt;code&gt;~/.aptly/public/&lt;/code&gt; directory. You can start any HTTP server
to serve this directory as static files, or use aptly built-in webserver for testing:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly serve
Serving published repositories, recommended apt sources list:

# ./wheezy [amd64] publishes {main: [wheezy-final-20141009]: Merged from sources: &#39;wheezy-main-7.6&#39;, &#39;wheezy-updates-20141009&#39;, &#39;wheezy-security-20141009&#39;}
deb http://debian:8080/ wheezy main

Starting web server at: :8080 (press Ctrl+C to quit)...
&lt;/pre&gt;

&lt;p&gt;I can also visalize the objects I&amp;rsquo;ve created and dependencies:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly graph
Loading mirrors...
Loading local repos...
Loading snapshots...
Loading published repos...
Generating graph...
Rendered to PNG file: /tmp/aptly-graph128726742.png
&lt;/pre&gt;

&lt;p&gt;This would result in picture like this one:&lt;/p&gt;

&lt;p&gt;&lt;img class=&#34;img-responsive&#34; src=&#34;/img/aptly-graph.png&#34;&gt;&lt;/p&gt;

&lt;h3 id=&#34;toc_7&#34;&gt;Using repository&lt;/h3&gt;

&lt;p&gt;First I need to import public part of the key that was used to sign the repository
into trusted apt keyring on target machine.&lt;/p&gt;

&lt;p&gt;Export the key on machine with aptly:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ gpg --export --armor &gt; my_key.pub
&lt;/pre&gt;

&lt;p&gt;Copy &lt;code&gt;my_key.pub&lt;/code&gt; to target machine and import it into apt keyring:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ sudo apt-key add my_key.pub
OK
&lt;/pre&gt;

&lt;p&gt;It&amp;rsquo;s time to edit &lt;code&gt;/etc/apt/sources.list&lt;/code&gt;. I comment out default sources and add address of my
first machine running &lt;code&gt;aptly serve&lt;/code&gt; currently:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;#deb http://ftp.ru.debian.org/debian/ wheezy main
#deb-src http://ftp.ru.debian.org/debian/ wheezy main

deb http://10.0.2.14:8080/ wheezy main
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Repository is ready to be used:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ sudo apt-get update
Get:1 http://10.0.2.14 wheezy Release.gpg [490 B]
Hit http://10.0.2.14 wheezy Release
Hit http://10.0.2.14 wheezy/main amd64 Packages
Ign http://10.0.2.14 wheezy/main Translation-en_US
Ign http://10.0.2.14 wheezy/main Translation-en
Fetched 490 B in 0s (33.1 kB/s)
Reading package lists... Done

$ sudo apt-get upgrade
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following packages have been kept back:
  libc-bin libc6 openssh-client
The following packages will be upgraded:
  apt apt-utils base-files bash dpkg gnupg gpgv krb5-locales libapt-inst1.5 libapt-pkg4.12 libgnutls26 libgssapi-krb5-2 libk5crypto3 libkrb5-3 libkrb5support0 libssl1.0.0 libxfont1 locales
  multiarch-support tzdata
20 upgraded, 0 newly installed, 0 to remove and 3 not upgraded.
Need to get 19.6 MB of archives.
After this operation, 74.8 kB of additional disk space will be used.
Do you want to continue [Y/n]? y
Get:1 http://10.0.2.14/ wheezy/main base-files amd64 7.1wheezy6 [78.7 kB]
Get:2 http://10.0.2.14/ wheezy/main bash amd64 4.2+dfsg-0.1+deb7u3 [1,501 kB]
...
&lt;/pre&gt;

&lt;p&gt;As this repository has been published from snapshot, it would never change until it is update to new snapshot.
Good thing is that I can setup all my machine to use this repo and get identical set of packages
installed.
Bad thing is that I need to maintain and update my repo as updates are coming,
but if I have many machines, the advantage of predictable upgrades outweighs the maintenance costs.&lt;/p&gt;

&lt;h3 id=&#34;toc_8&#34;&gt;Upgrading repository&lt;/h3&gt;

&lt;p&gt;Several days after, when I update my mirrors I discover new security updates:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly mirror update wheezy-security
....
&lt;/pre&gt;

&lt;p&gt;So it&amp;rsquo;s time to create new snapshot:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly snapshot create wheezy-security-20141019 from mirror wheezy-security

Snapshot wheezy-security-20141019 successfully created.
You can run &#39;aptly publish snapshot wheezy-security-20141019&#39; to publish snapshot as Debian repository.
&lt;/pre&gt;

&lt;p&gt;And do merge once again:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly snapshot merge -latest wheezy-final-20141019 wheezy-main-7.6 wheezy-updates-20141009 wheezy-security-20141019

Snapshot wheezy-final-20141019 successfully created.
You can run &#39;aptly publish snapshot wheezy-final-20141019&#39; to publish snapshot as Debian repository.
&lt;/pre&gt;

&lt;p&gt;Now I can update my published repository by switching it to new snapshot:&lt;/p&gt;

&lt;pre&gt;
$ aptly publish switch wheezy wheezy-final-20141019
Loading packages...
Generating metadata files and linking package files...
Finalizing metadata files...

...

Cleaning up prefix &#34;.&#34; components main...

Publish for snapshot ./wheezy [amd64] publishes {main: [wheezy-final-20141019]: Merged from sources: &#39;wheezy-main-7.6&#39;, &#39;wheezy-updates-20141009&#39;, &#39;wheezy-security-20141019&#39;} has been successfully switched to new snapshot.
&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;apt-get&lt;/code&gt; would notice new packages on next update, and I can upgrade my target machine.&lt;/p&gt;

&lt;p&gt;If run &lt;code&gt;aptly graph&lt;/code&gt; again, the picture would be more interesting:&lt;/p&gt;

&lt;p&gt;&lt;img class=&#34;img-responsive&#34; src=&#34;/img/aptly-graph2.png&#34;&gt;&lt;/p&gt;

&lt;h3 id=&#34;toc_9&#34;&gt;Maintenance&lt;/h3&gt;

&lt;p&gt;You can drop old snapshots as they&amp;rsquo;re not used anymore. This would allow to cleanup some files
with &lt;code&gt;aptly db cleanup&lt;/code&gt;:&lt;/p&gt;

&lt;pre class=&#34;code&#34;&gt;
$ aptly db cleanup
Loading mirrors, local repos and snapshots...
Loading list of all packages...
Deleting unreferenced packages (23)...
Building list of files referenced by packages...
Building list of files in package pool...
Deleting unreferenced files (10)...
Compacting database...
&lt;/pre&gt;

&lt;p&gt;Package files are not deleted until there&amp;rsquo;s at least one object that references them (snapshot, mirror or
local repositories).&lt;/p&gt;

&lt;p&gt;Next tutorial is about &lt;a href=&#34;/tutorial/pull/&#34;&gt;pulling new version of packages from backports or 3rd party repos&lt;/a&gt;.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>aptly 0.8 - .udeb support, search and filtering</title>
      <link>http://www.aptly.info/post/aptly-0-8</link>
      <pubDate>Fri, 03 Oct 2014 21:22:00 UTC</pubDate>
      <author>Andrey Smirnov</author>
      <guid>http://www.aptly.info/post/aptly-0-8</guid>
      <description>

&lt;p&gt;&lt;a href=&#34;http://www.aptly.info&#34;&gt;aptly&lt;/a&gt; 0.8 has been released today.
For installation instructions, please proceed to &lt;a href=&#34;http://www.aptly.info#download&#34;&gt;Download&lt;/a&gt; page.&lt;/p&gt;

&lt;p&gt;Most important new features are:&lt;/p&gt;

&lt;h2 id=&#34;toc_0&#34;&gt;Searching for Packages&lt;/h2&gt;

&lt;p&gt;aptly has powerful &lt;a href=&#34;http://www.aptly.info/doc/feature/query&#34;&gt;query language&lt;/a&gt;
which allows to select subset of packages. Query language is used
in many commands: pulling packages between snapshots, copying, moving packages
between local repositories, filtering mirror contents, etc. \
aptly 0.8 allows to use queries to search mirrors, snapshots and local repos
for packages matching condition. E.g. all packages that have been built
from source package &lt;code&gt;apt&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ aptly mirror search wheezy-main &#39;$Source (apt)&#39;
apt-doc_0.9.7.9+deb7u1_all
apt-transport-https_0.9.7.9+deb7u1_amd64
apt-utils_0.9.7.9+deb7u1_amd64
libapt-pkg4.12_0.9.7.9+deb7u1_amd64
apt_0.9.7.9+deb7u1_amd64
libapt-pkg-dev_0.9.7.9+deb7u1_i386
apt_0.9.7.9+deb7u1_i386
libapt-pkg-doc_0.9.7.9+deb7u1_all
libapt-pkg-dev_0.9.7.9+deb7u1_amd64
libapt-inst1.5_0.9.7.9+deb7u1_amd64
libapt-inst1.5_0.9.7.9+deb7u1_i386
apt-utils_0.9.7.9+deb7u1_i386
apt-transport-https_0.9.7.9+deb7u1_i386
libapt-pkg4.12_0.9.7.9+deb7u1_i386
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;aptly can also search whole package database for packages matching condition. For
example, all packages with name starting with &lt;code&gt;pam&lt;/code&gt;, not including source packages:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ aptly package search &#39;Name (% pam*), !$Architecture (source)&#39;
pam-dbus-notify_0.2.1-1_all
paml_4.5-1_amd64
paman_0.9.4-1_i386
pam-pkcs11-dbg_0.6.8-1_amd64
pamusb-common_0.5.0-4_i386
pamusb-common_0.5.0-4_amd64
pamusb-tools_0.5.0-4_all
paman_0.9.4-1_amd64
paml-doc_4.5-1_all
pam-pkcs11-dbg_0.6.8-1_i386
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;We can get details about packages, including its inclusion into other objects:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ aptly package show -with-references libattr1_1:2.4.46-8_amd64
Package: libattr1
Version: 1:2.4.46-8
Installed-Size: 61
Priority: required
...

References to package:
  mirror [wheezy-main]: http://mirror.yandex.ru/debian/ wheezy
  mirror [wheezy-main-src]: http://mirror.yandex.ru/debian/ wheezy [src]
  snapshot [wheezy-7.5]: Snapshot from mirror [wheezy-main]: http://mirror.yandex.ru/debian/ wheezy
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;toc_1&#34;&gt;Filtering Snapshots&lt;/h2&gt;

&lt;p&gt;Now snapshots could be filtered directly to produce other snapshots. Prior to that,
the same effect could be achieved using empty snapshot as one of the arguments
to &lt;code&gt;aptly snapshot pull&lt;/code&gt; command. Filtering is based on package queries as well.
E.g. extract &amp;lsquo;required&amp;rsquo; part of Debian into separate snapshot:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ aptly snapshot filter wheezy-7.5 wheezy-7.5-required &#39;Priority (required)&#39;
Loading packages (56121)...
Building indexes...

Snapshot wheezy-7.5-required successfully filtered.
You can run &#39;aptly publish snapshot wheezy-7.5-required&#39; to publish snapshot as Debian repository.

$ aptly snapshot show wheezy-7.5-required
Name: wheezy-7.5-required
Created At: 2014-10-03 21:50:30 MSK
Description: Filtered &#39;wheezy-7.5&#39;, query was: &#39;Priority (required)&#39;
Number of packages: 113
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;toc_2&#34;&gt;.udeb Support&lt;/h2&gt;

&lt;p&gt;aptly now supports .udeb (micro-deb) packages in mirrors, local repos and published repositories.
.udeb packages are used by Debian installer during initial installation phase. With .udeb support,
it should be possible to install Debian from repository published by aptly. As aptly doesn&amp;rsquo;t support
yet mirroring without resigning (leaving Debian signature as-is), it would require some changes to installer
in order to support custom key.&lt;/p&gt;

&lt;h2 id=&#34;toc_3&#34;&gt;Concurrent Mirror Update&lt;/h2&gt;

&lt;p&gt;Prior to version 0.8, aptly was locking database (which prevented any concurrent operations)
during whole &lt;code&gt;aptly mirror update&lt;/code&gt; run, which included
download of package files that might take hours. aptly 0.8 would unlock the database
after package index download (right before package files download), so during download phase
other commands could be run, e.g. create another mirror, take snapshots, publish other repositories
and so on. aptly locks repository being updated during package download to prevent modifications
to the repository.&lt;/p&gt;

&lt;h2 id=&#34;toc_4&#34;&gt;All Changes&lt;/h2&gt;

&lt;p&gt;Full list of changes since 0.7.1:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;aptly supports &lt;strong&gt;concurrent operations while mirror is updated&lt;/strong&gt;, new flag
  &lt;code&gt;-force&lt;/code&gt; for &lt;a href=&#34;http://www.aptly.info/doc/aptly/mirror/update/&#34;&gt;aptly mirror update&lt;/a&gt;
  (&lt;a href=&#34;https://github.com/smira/aptly/issues/45&#34;&gt;#45&lt;/a&gt;) (&lt;a href=&#34;https://github.com/smira/aptly/issues/114&#34;&gt;#114&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;support for &lt;strong&gt;&lt;code&gt;.udeb&lt;/code&gt; packages (Debian installer)&lt;/strong&gt; in mirrors, local repos and
  published repositories
  (&lt;a href=&#34;https://github.com/smira/aptly/issues/108&#34;&gt;#108&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;new command &lt;a href=&#34;http://www.aptly.info/doc/aptly/snapshot/filter&#34;&gt;aptly snapshot filter&lt;/a&gt;:
  &lt;strong&gt;filtering snapshots&lt;/strong&gt; using package query, complementary
  to &lt;a href=&#34;http://www.aptly.info/doc/aptly/snapshot/pull/&#34;&gt;snapshot pulling&lt;/a&gt;
  (&lt;a href=&#34;https://github.com/smira/aptly/issues/82&#34;&gt;#82&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;searching for packages matching query&lt;/strong&gt; in
  &lt;a href=&#34;http://www.aptly.info/doc/aptly/mirror/search&#34;&gt;mirrors&lt;/a&gt;,
  &lt;a href=&#34;http://www.aptly.info/doc/aptly/repo/search&#34;&gt;local repos&lt;/a&gt;,
  &lt;a href=&#34;http://www.aptly.info/doc/aptly/snapshot/search&#34;&gt;snapshots&lt;/a&gt; and
  &lt;a href=&#34;http://www.aptly.info/doc/aptly/package/search&#34;&gt;whole package database&lt;/a&gt;
  (&lt;a href=&#34;https://github.com/smira/aptly/issues/81&#34;&gt;#81&lt;/a&gt;)
  (&lt;a href=&#34;https://github.com/smira/aptly/issues/80&#34;&gt;#80&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;new command &lt;a href=&#34;http://www.aptly.info/doc/aptly/package/show/&#34;&gt;aptly package show&lt;/a&gt;:
  displaying &lt;strong&gt;details about package&lt;/strong&gt;, its inclusion into snapshots,
  mirrors, local repos
  (&lt;a href=&#34;https://github.com/smira/aptly/issues/80&#34;&gt;#80&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;&lt;a href=&#34;http://www.aptly.info/doc/aptly/mirror/edit/&#34;&gt;aptly mirror edit&lt;/a&gt; now supports changing list of architectures
  and download source setting
  (&lt;a href=&#34;https://github.com/smira/aptly/issues/109&#34;&gt;#109&lt;/a&gt;)
  (&lt;a href=&#34;https://github.com/smira/aptly/issues/99&#34;&gt;#99&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;workaround S3/apt issue with &lt;code&gt;+&lt;/code&gt; in package filenames
  (S3 config option &lt;code&gt;plusWorkaround&lt;/code&gt;)
  (&lt;a href=&#34;https://github.com/smira/aptly/issues/105&#34;&gt;#105&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;when publishing to S3 it&amp;rsquo;s possible to choose reduced redundancy storage and
  server-side encryption (S3 config options &lt;code&gt;storageClass&lt;/code&gt; and &lt;code&gt;encryptionMethod&lt;/code&gt;)
  (&lt;a href=&#34;https://github.com/smira/aptly/issues/105&#34;&gt;#105&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;when signing published repository, it&amp;rsquo;s possible to pass passphrase
  for GPG key with flags &lt;code&gt;-passphrase&lt;/code&gt; or &lt;code&gt;-passphrase-file&lt;/code&gt;
  (&lt;a href=&#34;https://github.com/smira/aptly/issues/194&#34;&gt;#94&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;new flag &lt;code&gt;-force-replace&lt;/code&gt; in &lt;a href=&#34;http://www.aptly.info/doc/aptly/repo/add/&#34;&gt;aptly repo add&lt;/a&gt; command
  to replace conflicting packages automatically
  (&lt;a href=&#34;https://github.com/smira/aptly/issues/83&#34;&gt;#83&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;dependency resolution algorithm has been improved
  (&lt;a href=&#34;https://github.com/smira/aptly/issues/100&#34;&gt;#100&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;aptly now supports mirroring over FTP
  (&lt;a href=&#34;https://github.com/smira/aptly/issues/48&#34;&gt;#48&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;bug fix: for boolean options, settings
  from configuration file were overriding settings on command line
  (&lt;a href=&#34;https://github.com/smira/aptly/issues/104&#34;&gt;#104&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;bug fix: &lt;a href=&#34;http://www.aptly.info/doc/aptly/publish/list/&#34;&gt;aptly publish list&lt;/a&gt; with &lt;code&gt;-raw&lt;/code&gt; flag
  hasn&amp;rsquo;t been displaying storage prefix for repositories published to S3
  (&lt;a href=&#34;https://github.com/smira/aptly/issues/113&#34;&gt;#113&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;bug fix: dropping repositories published to S3 might result in &amp;ldquo;bad signature&amp;rdquo; error&lt;/li&gt;
  &lt;li&gt;bug fix: publishing repositories with &lt;code&gt;/&lt;/code&gt; in distribution name isn&amp;rsquo;t allowed anymore,
  when guessing distribution &lt;code&gt;/&lt;/code&gt; is replaced with &lt;code&gt;-&lt;/code&gt;
  (&lt;a href=&#34;https://github.com/smira/aptly/issues/110&#34;&gt;#110&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;bug fix: download errors while mirroring now include original
  URL
  (&lt;a href=&#34;https://github.com/smira/aptly/issues/26&#34;&gt;#26&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>aptly repo search</title>
      <link>http://www.aptly.info/doc/aptly/repo/search</link>
      <pubDate>Fri, 29 Aug 2014 11:17:38 UTC</pubDate>
      <author>Andrey Smirnov</author>
      <guid>http://www.aptly.info/doc/aptly/repo/search</guid>
      <description>

&lt;h2 id=&#34;toc_0&#34;&gt;aptly repo search&lt;/h2&gt;

&lt;p&gt;Search local repositories for packages matching query.&lt;/p&gt;

&lt;p&gt;Usage:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ aptly repo search &amp;lt;name&amp;gt; &amp;lt;package-query&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Params are:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;name&lt;/code&gt; packages would be removed from this local repository&lt;/li&gt;
&lt;li&gt;&lt;code&gt;package-query&lt;/code&gt; is a &lt;a href=&#34;/doc/feature/query/&#34;&gt;package query&lt;/a&gt; to
search for packages&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Flags:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-with-deps=false&lt;/code&gt;: include dependencies of matching packages
into search results&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Example:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ aptly repo search internal-pkg &#39;Version (&amp;gt;= 4.5)&#39;
libtinfo5_5.9-10_i386
perl-base_5.14.2-21+deb7u1_amd64
ncurses-base_5.9-10_all
xz-utils_5.1.1alpha+20120614-2_i386
gcc-4.7-base_4.7.2-5_amd64
libtinfo5_5.9-10_amd64
base-files_7.1wheezy5_i386
ncurses-bin_5.9-10_i386
xz-utils_5.1.1alpha+20120614-2_amd64
liblzma5_5.1.1alpha+20120614-2_i386
coreutils_8.13-3.5_amd64
liblzma5_5.1.1alpha+20120614-2_amd64
libncurses5_5.9-10_amd64
coreutils_8.13-3.5_i386
libncurses5_5.9-10_i386
perl-base_5.14.2-21+deb7u1_i386
base-files_7.1wheezy5_amd64
ncurses-bin_5.9-10_amd64
gcc-4.7-base_4.7.2-5_i386
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>aptly package show</title>
      <link>http://www.aptly.info/doc/aptly/package/show</link>
      <pubDate>Fri, 29 Aug 2014 11:17:38 UTC</pubDate>
      <author>Andrey Smirnov</author>
      <guid>http://www.aptly.info/doc/aptly/package/show</guid>
      <description>

&lt;h2 id=&#34;toc_0&#34;&gt;aptly package show&lt;/h2&gt;

&lt;p&gt;Display details about packages from whole package database. Command
show does searching much like &lt;a href=&#34;/doc/aptly/package/search/&#34;&gt;&lt;code&gt;aptly package search&lt;/code&gt;&lt;/a&gt;
command does, but displays complete information about the package:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;contents of control file&lt;/li&gt;
&lt;li&gt;(optionally) information about package files in the pool&lt;/li&gt;
&lt;li&gt;(optionally) list of mirrors, local repos and snapshots that reference (include) this package&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;It is possible to submit any search query to this command, but it is much more common
to have queries resulting in single package.&lt;/p&gt;

&lt;p&gt;Usage:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ aptly package show &amp;lt;package-query&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Params are:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;package-query&lt;/code&gt; is a &lt;a href=&#34;/doc/feature/query/&#34;&gt;package query&lt;/a&gt; to
search for packages (most usually in the format of package
reference, e.g. &lt;code&gt;bwbar_1.2.3-2_amd64&lt;/code&gt;)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Flags:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-with-files=false&lt;/code&gt;: display list of package files in the package pool&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-with-references=false&lt;/code&gt;: display list of mirrors, snapshots and local repos
which reference this package.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Example:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ aptly package show -with-files -with-references bwbar_1.2.3-2_source
Package: bwbar
Version: 1.2.3-2
Priority: source
Section: net
Maintainer: Julien Danjou &amp;lt;acid@debian.org&amp;gt;
Architecture: any
Format: 1.0
Build-Depends: debhelper (&amp;gt;&amp;gt; 7.0.0), libpng12-dev, cdbs
Files: 138ba54405656adc16c882839482795e 54582 bwbar_1.2.3-2.diff.gz
 cd4f216514cf38f42be9d7b35d429adc 1586 bwbar_1.2.3-2.dsc
 766265ddf0615b552ff19d12f78be719 34142 bwbar_1.2.3.orig.tar.gz
Checksums-Sha1: c5259d7fc3ac750d9d9b8d458d702a1bc49a708e 54582 bwbar_1.2.3-2.diff.gz
 674a6f5db91e83f9ad4f30d1563d3249aa21bb39 1586 bwbar_1.2.3-2.dsc
 13f5a17658a5c5adbb0db5b0fdd88805d6b3158b 34142 bwbar_1.2.3.orig.tar.gz
Directory: pool/main/b/bwbar
Binary: bwbar
Standards-Version: 3.9.2
Checksums-Sha256: 1ae625e6a29b745d24bab9185692ecc5b17cb4624d2019ae9a94e08a89f15edb 54582 bwbar_1.2.3-2.diff.gz
 b2d022dd912bc1129b0d0e216b7f8e587649582578484c776bcbe81afe993879 1586 bwbar_1.2.3-2.dsc
 bd8f5079f17b1dec6eae81ddc43c58c49b777b336fd902ffbb8e631885fbb45c 34142 bwbar_1.2.3.orig.tar.gz

Files in the pool:
  /Users/smira/.aptly/pool/13/8b/bwbar_1.2.3-2.diff.gz
  /Users/smira/.aptly/pool/cd/4f/bwbar_1.2.3-2.dsc
  /Users/smira/.aptly/pool/76/62/bwbar_1.2.3.orig.tar.gz

References to package:
  mirror [wheezy-main-src]: http://mirror.yandex.ru/debian/ wheezy [src]
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>aptly package</title>
      <link>http://www.aptly.info/doc/aptly/package</link>
      <pubDate>Fri, 29 Aug 2014 11:17:38 UTC</pubDate>
      <author>Andrey Smirnov</author>
      <guid>http://www.aptly.info/doc/aptly/package</guid>
      <description>

&lt;h2 id=&#34;toc_0&#34;&gt;aptly package&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;aptly package&lt;/code&gt; family of command perform operation on the whole
collection of packages in apty database.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>aptly package search</title>
      <link>http://www.aptly.info/doc/aptly/package/search</link>
      <pubDate>Fri, 29 Aug 2014 11:17:38 UTC</pubDate>
      <author>Andrey Smirnov</author>
      <guid>http://www.aptly.info/doc/aptly/package/search</guid>
      <description>

&lt;h2 id=&#34;toc_0&#34;&gt;aptly package search&lt;/h2&gt;

&lt;p&gt;Search whole package database for packages matching query.
Whole database of packages includes all packages (deduplicated)
from all the mirrors, local repos and snapshots.&lt;/p&gt;

&lt;p&gt;In order to get more detailed information about the package,
use &lt;a href=&#34;/doc/aptly/package/show/&#34;&gt;&lt;code&gt;aptly package show&lt;/code&gt;&lt;/a&gt; command.&lt;/p&gt;

&lt;p&gt;Usage:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ aptly package search &amp;lt;package-query&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Params are:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;package-query&lt;/code&gt; is a &lt;a href=&#34;/doc/feature/query/&#34;&gt;package query&lt;/a&gt; to
search for packages&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Example:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ aptly package search &#39;Version (&amp;gt;=1.2.3-2), Version (&amp;lt;1.2.3-3)&#39;
libibmad-dev_1.2.3-20090314-1.1_amd64
libibumad-dev_1.2.3-20090314-1.1_i386
libibumad1_1.2.3-20090314-1.1_amd64
libibumad1_1.2.3-20090314-1.1_i386
libghc-uuid-dev_1.2.3-2+b3_amd64
python-mysqldb_1.2.3-2_i386
libibumad-dev_1.2.3-20090314-1.1_amd64
libibmad_1.2.3-20090314-1.1_source
python-mysqldb_1.2.3-2_amd64
jpegoptim_1.2.3-2+b2_i386
libghc-uuid-doc_1.2.3-2_all
libjibx1.2-java-doc_1.2.3-2_all
bwbar_1.2.3-2_amd64
libghc-certificate-doc_1.2.3-2_all
haskell-certificate_1.2.3-2_source
bwbar_1.2.3-2_i386
jpegoptim_1.2.3-2_source
libghc-certificate-dev_1.2.3-2_amd64
libibmad1_1.2.3-20090314-1.1_i386
libibmad-dev_1.2.3-20090314-1.1_i386
libjibx1.2-java_1.2.3-2_source
python-mysqldb-dbg_1.2.3-2_i386
shush_1.2.3-2_i386
moksha.common_1.2.3-2~bpo70+1_source
libghc-certificate-prof_1.2.3-2_i386
libghc-uuid-prof_1.2.3-2+b3_amd64
libghc-uuid-prof_1.2.3-2+b4_i386
shush_1.2.3-2_source
libghc-certificate-prof_1.2.3-2_amd64
libjibx1.2-java_1.2.3-2_all
libjibx-java_1.2.3-2_all
libghc-uuid-dev_1.2.3-2+b4_i386
python-mysqldb_1.2.3-2_source
haskell-uuid_1.2.3-2_source
libibumad_1.2.3-20090314-1.1_source
libghc-certificate-dev_1.2.3-2_i386
jpegoptim_1.2.3-2+b2_amd64
python-moksha.common_1.2.3-2~bpo70+1_all
bwbar_1.2.3-2_source
python-mysqldb-dbg_1.2.3-2_amd64
libibmad1_1.2.3-20090314-1.1_amd64
shush_1.2.3-2_amd64
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>aptly mirror search</title>
      <link>http://www.aptly.info/doc/aptly/mirror/search</link>
      <pubDate>Fri, 29 Aug 2014 11:17:38 UTC</pubDate>
      <author>Andrey Smirnov</author>
      <guid>http://www.aptly.info/doc/aptly/mirror/search</guid>
      <description>

&lt;h2 id=&#34;toc_0&#34;&gt;aptly mirror search&lt;/h2&gt;

&lt;p&gt;Search mirror for packages matching query.&lt;/p&gt;

&lt;p&gt;Usage:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ aptly mirror search &amp;lt;name&amp;gt; &amp;lt;package-query&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Params are:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;name&lt;/code&gt; is a mirror name (given when mirror was created)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;package-query&lt;/code&gt; is a &lt;a href=&#34;/doc/feature/query/&#34;&gt;package query&lt;/a&gt; to
search for packages&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Flags:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-with-deps=false&lt;/code&gt;: include dependencies of matching packages
into search results&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Example:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ aptly mirror search wheezy &#39;Name (% nginx*), $Architecture (i386), !Name (% *-dbg)&#39;
nginx-full_1.2.1-2.2+wheezy2_i386
nginx-extras_1.2.1-2.2+wheezy2_i386
nginx-light_1.2.1-2.2+wheezy2_i386
nginx-common_1.2.1-2.2+wheezy2_all
nginx-doc_1.2.1-2.2+wheezy2_all
nginx-naxsi-ui_1.2.1-2.2+wheezy2_all
nginx_1.2.1-2.2+wheezy2_all
nginx-naxsi_1.2.1-2.2+wheezy2_i386
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>aptly mirror edit</title>
      <link>http://www.aptly.info/doc/aptly/mirror/edit</link>
      <pubDate>Fri, 29 Aug 2014 11:17:38 UTC</pubDate>
      <author>Andrey Smirnov</author>
      <guid>http://www.aptly.info/doc/aptly/mirror/edit</guid>
      <description>

&lt;h2 id=&#34;toc_0&#34;&gt;aptly mirror edit&lt;/h2&gt;

&lt;p&gt;Command edit allows to change mirror settings: filter query, whether
to include dependencies while filtering, list of architectures to process.&lt;/p&gt;

&lt;p&gt;Usage:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ aptly mirror edit &amp;lt;name&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Params are:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;name&lt;/code&gt; is a mirror name (given when mirror was created)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Flags:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-filter=&lt;/code&gt;: &lt;a href=&#34;/doc/feature/query/&#34;&gt;package query&lt;/a&gt; which is applied to
packages in the mirror, set to empty to disable filtering&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-filter-with-deps=false&lt;/code&gt;: when filtering, include dependencies of
matching packages as well&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-architectures=&lt;/code&gt;: global flag to change architectures list.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-with-sources=false&lt;/code&gt;: download source packages in addition to
binary packages&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-with-udebs=false&lt;/code&gt;: download .udeb packages (Debian installer
support)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In order to apply new filtering settings, &lt;a href=&#34;/doc/aptly/mirror/update/&#34;&gt;update&lt;/a&gt;
mirror.&lt;/p&gt;

&lt;p&gt;Examples:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ aptly mirror edit -filter=nginx -filter-with-deps wheezy-main
Mirror [wheezy-main]: http://mirror.yandex.ru/debian/ wheezy successfully updated.

$ aptly mirror edit -architectures=i386,amd64 sensu
Downloading http://repos.sensuapp.org/apt/dists/sensu/Release...
Mirror [sensu]: http://repos.sensuapp.org/apt/ sensu successfully updated.
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>aptly snapshot search</title>
      <link>http://www.aptly.info/doc/aptly/snapshot/search</link>
      <pubDate>Fri, 29 Aug 2014 11:17:38 UTC</pubDate>
      <author>Andrey Smirnov</author>
      <guid>http://www.aptly.info/doc/aptly/snapshot/search</guid>
      <description>

&lt;h2 id=&#34;toc_0&#34;&gt;aptly snapshot search&lt;/h2&gt;

&lt;p&gt;Search snapshot for packages matching query.&lt;/p&gt;

&lt;p&gt;Usage:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ aptly snapshot search &amp;lt;name&amp;gt; &amp;lt;package-query&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Params are:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;name&lt;/code&gt; is snapshot name which has been given during snapshot
creation&lt;/li&gt;
&lt;li&gt;&lt;code&gt;package-query&lt;/code&gt; is a &lt;a href=&#34;/doc/feature/query/&#34;&gt;package query&lt;/a&gt; to
search for packages&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Flags:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-with-deps=false&lt;/code&gt;: include dependencies of matching packages
into search results&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Example:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ aptly snapshot search backports &#39;nginx, !Name (% *-light)&#39;
nginx_1.6.0-1~bpo70+1_all
nginx-full_1.6.0-1~bpo70+1_amd64
nginx-extras_1.6.0-1~bpo70+1_i386
nginx-extras_1.6.0-1~bpo70+1_amd64
nginx-full_1.6.0-1~bpo70+1_i386
nginx-naxsi_1.6.0-1~bpo70+1_amd64
nginx-naxsi_1.6.0-1~bpo70+1_i386
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>aptly snapshot merge</title>
      <link>http://www.aptly.info/doc/aptly/snapshot/merge</link>
      <pubDate>Fri, 08 Aug 2014 11:17:38 UTC</pubDate>
      <author>Andrey Smirnov</author>
      <guid>http://www.aptly.info/doc/aptly/snapshot/merge</guid>
      <description>

&lt;h2 id=&#34;toc_0&#34;&gt;aptly snapshot merge&lt;/h2&gt;

&lt;p&gt;Command merges several &lt;code&gt;source&lt;/code&gt; snapshots into new &lt;code&gt;destination&lt;/code&gt; snapshot.
Merge happens from left to right. By default, packages with the same
name-architecture pair are replaced during merge (package from latest snapshot on the list wins).&lt;/p&gt;

&lt;p&gt;With &lt;code&gt;-latest&lt;/code&gt; flag, package with latest version wins. With &lt;code&gt;-no-remove&lt;/code&gt;
flag, all versions of packages are preserved during merge.&lt;/p&gt;

&lt;p&gt;If only one snapshot is specified, merge copies &lt;code&gt;source&lt;/code&gt; into &lt;code&gt;destination&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Usage:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ aptly snapshot merge &amp;lt;destination&amp;gt; &amp;lt;source&amp;gt; [&amp;lt;source&amp;gt;...]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Params:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;destination&lt;/code&gt; is a name of the snapshot that would be created&lt;/li&gt;
&lt;li&gt;&lt;code&gt;source&lt;/code&gt; is a list of snapshot names that would be merged together&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Flags:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-latest=false&lt;/code&gt;: use only the latest version of each package&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-no-remove=false&lt;/code&gt;: don&amp;rsquo;t remove duplicate arch/name packages&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Example:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ aptly snapshot merge debian-w-backports debian-main debian-backports

Snapshot debian-w-backports successfully created.
You can run &#39;aptly publish snapshot debian-w-backports&#39; to publish snapshot as Debian repository.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Commands</title>
      <link>http://www.aptly.info/doc/commands</link>
      <pubDate>Fri, 08 Aug 2014 11:17:38 UTC</pubDate>
      <author>Andrey Smirnov</author>
      <guid>http://www.aptly.info/doc/commands</guid>
      <description>

&lt;h2 id=&#34;toc_0&#34;&gt;Commands&lt;/h2&gt;

&lt;p&gt;aptly supports commands in several basic categories:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;mirror&lt;/code&gt;: manage, update mirrors of remote repositories&lt;/li&gt;
&lt;li&gt;&lt;code&gt;repo&lt;/code&gt;: manage local package repositories, add, remove, move, copy
packages&lt;/li&gt;
&lt;li&gt;&lt;code&gt;snapshot&lt;/code&gt;: create, merge, manage snapshots&lt;/li&gt;
&lt;li&gt;&lt;code&gt;publish&lt;/code&gt;: publish snapshot or local repository&lt;/li&gt;
&lt;li&gt;&lt;code&gt;serve&lt;/code&gt;: quickly export published repositories via HTTP&lt;/li&gt;
&lt;li&gt;&lt;code&gt;db&lt;/code&gt;: cleanup database and package pool, recover database after failure&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>aptly snapshot verify</title>
      <link>http://www.aptly.info/doc/aptly/snapshot/verify</link>
      <pubDate>Fri, 08 Aug 2014 11:17:38 UTC</pubDate>
      <author>Andrey Smirnov</author>
      <guid>http://www.aptly.info/doc/aptly/snapshot/verify</guid>
      <description>

&lt;h2 id=&#34;toc_0&#34;&gt;aptly snapshot verify&lt;/h2&gt;

&lt;p&gt;Verifies dependencies between packages in snapshot &lt;code&gt;&amp;lt;name&amp;gt;&lt;/code&gt; and reports
unsatisfied dependencies. Command might take additional snapshots as
dependency sources.&lt;/p&gt;

&lt;p&gt;Usage:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ aptly snapshot verify &amp;lt;name&amp;gt; [&amp;lt;source&amp;gt; ...]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Params:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;name&lt;/code&gt; is snapshot name which has been given during snapshot
creation&lt;/li&gt;
&lt;li&gt;&lt;code&gt;source&lt;/code&gt; is a optional list of snapshot names which would be used as
additional sources&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;If additional sources are given, depdencies would be searched for in
full list of &lt;code&gt;&amp;lt;name&amp;gt;&lt;/code&gt; and &lt;code&gt;&amp;lt;source&amp;gt;&lt;/code&gt; snapshots.&lt;/p&gt;

&lt;p&gt;If architectures are limited (with config &lt;code&gt;architectures&lt;/code&gt; or option
&lt;code&gt;-architectures&lt;/code&gt;), only mentioned architectures are checked for internal
dependencies, otherwise &lt;code&gt;aptly&lt;/code&gt; will check all architectures in the
snapshot.&lt;/p&gt;

&lt;p&gt;By using &lt;code&gt;-dep-follow-source&lt;/code&gt; global flag you can verify that snapshot
has all source packages available to re-build packages from source.&lt;/p&gt;

&lt;p&gt;Example:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ aptly snapshot verify snap-deb2-main
Missing dependencies (7):
  oracle-instantclient11.2-basic [i386]
  scsh-0.6 [amd64]
  fenix [amd64]
  fenix-plugins-system [amd64]
  mozart (&amp;gt;= 1.4.0) [amd64]
  scsh-0.6 (&amp;gt;= 0.6.6) [amd64]
  oracle-instantclient11.2-basic [amd64]
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>Overview</title>
      <link>http://www.aptly.info/doc/overview</link>
      <pubDate>Fri, 08 Aug 2014 11:17:38 UTC</pubDate>
      <author>Andrey Smirnov</author>
      <guid>http://www.aptly.info/doc/overview</guid>
      <description>

&lt;h2 id=&#34;toc_0&#34;&gt;Overview&lt;/h2&gt;

&lt;p class=&#34;lead&#34;&gt;aptly&#39;s goal is to establish repeatiblity and controlled changes in
package environments.&lt;/p&gt;

&lt;p&gt;aptly produces a fixed set of packages in the repository,
so that package installation and upgrade becomes deterministic. At the
same time aptly is able to perform controlled, fine-grained changes to
repository content. aptly allows you to transistion your package environment to a
new version, or rollback to a previous version.&lt;/p&gt;

&lt;p&gt;aptly has several core entities:&lt;/p&gt;

&lt;dl class=&#34;dl-horizontal&#34;&gt;
    &lt;dt&gt;mirror&lt;/dt&gt;
    &lt;dd&gt;mirror of remote repository, consists of metadata, list of packages
    and package files&lt;/dd&gt;
    &lt;dt&gt;local repo&lt;/dt&gt;
    &lt;dd&gt;local package repository, consists of metadata, packages and files,
    packages can be easily added and removed&lt;/dd&gt;
    &lt;dt&gt;snapshot&lt;/dt&gt;
    &lt;dd&gt;immutable list of packages, basic block to implement repeatability
    and controlled changes&lt;/dd&gt;
    &lt;dt&gt;published&lt;br&gt; repository&lt;/dt&gt;
    &lt;dd&gt;published representation of aptly generated snapshot or local repository, ready to
    be consumed by apt tools&lt;/dd&gt;
&lt;/dl&gt;

&lt;p&gt;The schema of aptly&amp;rsquo;s commands and transitions between entities:&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;/img/schema.png&#34; alt=&#34;aptly core schema&#34; class=&#34;img-responsive&#34;&gt;&lt;/p&gt;

&lt;p&gt;We can start with creating &lt;a href=&#34;/doc/aptly/mirror/create&#34;&gt;mirrors of remote
repositories&lt;/a&gt;. Also we can create &lt;a href=&#34;/doc/aptly/repo/create&#34;&gt;local package
repositories&lt;/a&gt; and &lt;a href=&#34;/doc/aptly/repo/add&#34;&gt;import package files&lt;/a&gt;.
Local repos could be modified by &lt;a href=&#34;/doc/aptly/repo/copy&#34;&gt;copying&lt;/a&gt; and
&lt;a href=&#34;/doc/aptly/repo/move&#34;&gt;moving&lt;/a&gt; packages between local repositories and
&lt;a href=&#34;/doc/aptly/repo/import&#34;&gt;importing&lt;/a&gt; them from mirrors. Snapshot could be
&lt;a href=&#34;/doc/aptly/snapshot/create&#34;&gt;created&lt;/a&gt; from remote repository (official
Debain repositories, backports, 3rd party repos, etc.) or your local
repository (custom built packages, your own software). Snapshots can be
used to produce new snapshots by &lt;a href=&#34;/doc/aptly/snapshot/filter/&#34;&gt;filtering&lt;/a&gt;
other snapshots, &lt;a href=&#34;/doc/aptly/snapshot/pull&#34;&gt;pulling&lt;/a&gt;
packages with dependencies between snapshots and by
&lt;a href=&#34;/doc/aptly/snapshot/merge&#34;&gt;merging&lt;/a&gt; snapshots. Any snapshot can be
&lt;a href=&#34;/doc/aptly/publish/snapshot&#34;&gt;published&lt;/a&gt; to location (distribution name,
prefix) and consumed by &lt;code&gt;apt&lt;/code&gt; tools on your Debian systems. Local
repositories could be &lt;a href=&#34;/doc/aptly/publish/repo&#34;&gt;published directly&lt;/a&gt;
bypassing snapshot step.&lt;/p&gt;

&lt;p&gt;Next section, &lt;a href=&#34;/doc/why/&#34;&gt;Why aptly?&lt;/a&gt; describes why aptly is unique.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>